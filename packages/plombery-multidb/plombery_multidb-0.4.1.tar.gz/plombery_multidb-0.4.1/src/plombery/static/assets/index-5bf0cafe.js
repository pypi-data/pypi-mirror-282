var os=Object.defineProperty;var cs=(s,t,r)=>t in s?os(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var ne=(s,t,r)=>(cs(s,typeof t!="symbol"?t+"":t,r),r);import{k as ls,r as l,j as e,u as Ae,a as ds,F as us,b as ms,c as xs,d as hs,e as gs,o as js,f as ps,s as fs,g as bs,h as ys,i as vs,l as Ns,m as h,n as k,p as Q,q as N,A as ks,t as y,v as J,w as _,C as ws,x as c,y as M,z as Ts,B as Fe,D as He,E as q,S as Ss,M as _s,G as Cs,H as Es,I as ae,_ as ie,J as D,K as A,L as $,Q as Ve,N as Ls,O as Rs,P as Ds,R as $s,T as W,U as E,V as Ue,W as oe,X as F,Y as O,Z as xe,$ as Ps,a0 as Os,a1 as qe,a2 as H,a3 as Is,a4 as Ms,a5 as ze,a6 as As,a7 as Fs,a8 as Be,a9 as R,aa as v,ab as X,ac as Y,ad as he,ae as ge,af as je,ag as T,ah as pe,ai as Hs,aj as Vs,ak as Us,al as qs,am as zs,an as Bs,ao as Gs,ap as Ks,aq as Qs,ar as Js,as as Ws,at as fe,au as Xs,av as Le,aw as Re,ax as Ys,ay as be,az as Ge,aA as Zs,aB as et,aC as st,aD as tt,aE as rt,aF as nt,aG as at,aH as it,aI as ot,aJ as ct,aK as lt,aL as dt,aM as ut}from"./vendor-0e4b1091.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();class ce{constructor(t,r,n,a,i){this.id=t,this.name=r,this.description=n,this.tasks=a,this.triggers=i}hasTrigger(){return this.triggers.some(t=>!!t.schedule)}getNextFireTime(){const r=this.triggers.filter(n=>!!n.next_fire_time).sort((n,a)=>n.next_fire_time.getTime()-a.next_fire_time.getTime())[0];if(r)return r.next_fire_time}}class mt extends Error{constructor(r,n,a){super(r);ne(this,"data");ne(this,"status");this.data={data:a,status:n},this.status=n}}const xt=`${window.location.protocol}//${window.location.host}/api`,Z={}.VITE_API_BASE_URL||xt,ye=ls.create({prefixUrl:Z,credentials:"include",redirect:"follow"}),ve=()=>Z,P=async(s,t)=>(await ye.get(s,t)).json(),Ke=async(s,t)=>{try{return await ye.post(s,t).json()}catch(r){const n=r;throw new mt(n.message,n.response.status,await n.response.json())}},ht=()=>{const s=new URL(Z);return s.pathname=s.pathname.replace(/api$/,""),s},De=s=>`${Z}/pipelines/${s}/run`,gt=async()=>await P("auth/whoami"),jt=async()=>{await Ke("auth/logout")},pt=()=>({queryKey:["pipelines"],queryFn:async()=>{const s=await P("pipelines/");return s.forEach(t=>{t.triggers.forEach(r=>{r.next_fire_time&&(r.next_fire_time=new Date(r.next_fire_time))})}),s.map(t=>new ce(t.id,t.name,t.description,t.tasks,t.triggers))},initialData:[]}),Ne=s=>({queryKey:["pipeline",s],queryFn:async()=>{const t=await P(`pipelines/${s}`);return t.triggers.forEach(r=>{r.next_fire_time&&(r.next_fire_time=new Date(r.next_fire_time))}),new ce(t.id,t.name,t.description,t.tasks,t.triggers)},initialData:new ce("","","",[],[]),enabled:!!s}),ft=s=>({queryKey:["pipeline-input",s],queryFn:async()=>await P(`pipelines/${s}/input-schema`)}),ke=(s,t)=>({queryKey:["runs",s,t],queryFn:async()=>{const n=await P("runs/",{searchParams:{pipeline_id:s??"",trigger_id:t??""}});return n.forEach(a=>{a.start_time=new Date(a.start_time)}),n},initialData:[]}),$e=(s,t,r)=>({queryKey:["runs",s,t,r],queryFn:async()=>{const n=await P(`runs/${r}`);return n.start_time=new Date(n.start_time),n},enabled:!!(s&&t&&r)}),bt=s=>({queryKey:["logs",s],queryFn:async()=>{const t=await ye.get(`runs/${s}/logs`).text();return t?t.split(`
`).map((r,n)=>{const a=JSON.parse(r);return a.id=n,a.timestamp=new Date(a.timestamp),a}):[]},enabled:!!s,initialData:[]}),Qe=(s,t)=>`runs/${s}/data/${t}`,yt=(s,t)=>({queryKey:["getRunData",{runId:s,taskId:t}],queryFn:async()=>await P(Qe(s,t))}),Je=(s,t)=>({async mutationFn(r){return await Ke(`pipelines/${s}/run`,{json:{trigger_id:t,params:r}})}}),We=l.createContext({isAuthenticated:!1,isAuthenticationEnabled:!0,isLoading:!0,logout:async()=>{},user:null}),vt=(s,t)=>{switch(t.type){case"LOGIN":return{...s,isAuthenticated:!0,isAuthenticationEnabled:t.payload.isAuthenticationEnabled,user:t.payload.user};case"LOGOUT":return{...s,isAuthenticated:!1,user:null};case"POPULATE":return{...s,user:t.payload?{...s.user,...t.payload}:null};case"STOP_LOADING":return{...s,isLoading:!1};default:throw new Error("Unknown action type")}},Nt=({children:s})=>{const[t,r]=l.useReducer(vt,{isAuthenticated:!1,isAuthenticationEnabled:!0,isLoading:!0,logout:async()=>{await jt(),r({type:"LOGOUT"})},user:null});return l.useEffect(()=>{(async()=>{try{const{is_authentication_enabled:a,user:i}=await gt();(a&&i||!a)&&r({type:"LOGIN",payload:{user:i,isAuthenticationEnabled:a}})}catch(a){console.error(a)}finally{r({type:"STOP_LOADING"})}})()},[]),e.jsx(We.Provider,{value:t,children:t.isAuthenticationEnabled&&t.isLoading?"Loading...":s})},we=()=>l.useContext(We),kt=s=>`translate${s==="bottom"||s==="top"?"Y":"X"}(${s==="bottom"||s==="right"?"-":"+"}10%)`;function wt({initialOpen:s=!1,placement:t="bottom",modal:r,open:n,onOpenChange:a}={}){const[i,u]=l.useState(s),[d,p]=l.useState(),[o,x]=l.useState(),j=n??i,S=a??u,w=hs({placement:t,open:j,onOpenChange:S,whileElementsMounted:gs,middleware:[js(5),ps({fallbackAxisSideDirection:"end"}),fs({padding:5})]}),f=w.context,m=bs(f,{enabled:n==null}),g=ys(f),b=vs(f),L=Ns([m,g,b]);return l.useMemo(()=>({open:j,setOpen:S,...L,...w,modal:r,labelId:d,descriptionId:o,setLabelId:p,setDescriptionId:x}),[j,S,L,w,r,d,o])}const Xe=l.createContext(null),ee=()=>{const s=l.useContext(Xe);if(s==null)throw new Error("Popover components must be wrapped in <Popover />");return s};function Tt({children:s,modal:t=!0,...r}){const n=wt({modal:t,...r});return e.jsx(Xe.Provider,{value:n,children:s})}const St=l.forwardRef(function({children:t,asChild:r=!1,...n},a){const i=ee(),u=t.ref,d=Ae([i.refs.setReference,a,u]);return r&&l.isValidElement(t)?l.cloneElement(t,i.getReferenceProps({ref:d,...n,...t.props,"data-state":i.open?"open":"closed"})):e.jsx("button",{ref:d,type:"button","data-state":i.open?"open":"closed",...i.getReferenceProps(n),children:t})}),_t=l.forwardRef(function(t,r){const{context:n,...a}=ee(),i=Ae([a.refs.setFloating,r]),{isMounted:u,styles:d}=ds(n,{initial:({side:p})=>({opacity:0,transform:kt(p)})});return e.jsx(us,{children:u&&e.jsx(ms,{context:n,modal:a.modal,children:e.jsx("div",{ref:i,style:{position:a.strategy,top:a.y??0,left:a.x??0,width:"max-content",zIndex:20,...t.style,...d},"aria-labelledby":a.labelId,"aria-describedby":a.descriptionId,...a.getFloatingProps(t),children:t.children})})})});l.forwardRef(function({children:t,...r},n){const{setDescriptionId:a}=ee(),i=xs();return l.useLayoutEffect(()=>(a(i),()=>a(void 0)),[i,a]),e.jsx("p",{...r,ref:n,id:i,children:t})});l.forwardRef(function(t,r){const{setOpen:n}=ee();return e.jsx("button",{type:"button",ref:r,...t,onClick:a=>{var i;(i=t.onClick)==null||i.call(t,a),n(!1)}})});const Ct=()=>{const{logout:s,user:t}=we();return t?e.jsxs(h,{className:"gap-4 mt-8",children:[e.jsxs("div",{children:[e.jsx(k,{children:t.name}),e.jsx(Q,{children:t.email})]}),e.jsx(N,{size:"xs",variant:"secondary",color:"rose",icon:ks,onClick:async()=>await s()})]}):e.jsx("div",{children:"Not authenticated"})},Ye=0,le=1,Pe=2,Et={[Ye]:"light",[le]:"dark"},U="plomberyTheme",Lt=()=>{const s=localStorage[U]==="dark"?le:U in localStorage?Ye:Pe,[t,r]=l.useState(s);return e.jsx(Fe,{onIndexChange:n=>{let a=!1;return n===Pe?(localStorage.removeItem(U),a=window.matchMedia("(prefers-color-scheme: dark)").matches):(a=n===le,localStorage[U]=Et[n]),a?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),r(n)},index:t,children:e.jsxs(He,{variant:"solid",children:[e.jsx(q,{icon:Ss,children:"Light"}),e.jsx(q,{icon:_s,children:"Dark"}),e.jsx(q,{icon:Cs,children:"System"})]})})},Rt=()=>{const{user:s,isAuthenticationEnabled:t}=we();let r=e.jsx(Es,{});if(t&&s){const n=s.name.split(" ");r=n.length>1?`${n.at(0)[0]}${n.at(-1)[0]}`:n[0]}return e.jsxs(Tt,{placement:"bottom-start",children:[e.jsx(St,{children:e.jsx("div",{className:"flex justify-center items-center font-medium dark:bg-dark-tremor-background dark:ring-dark-tremor-ring ring-1 ring-slate-300 text-indigo-500 rounded-full hover:ring-2 hover:ring-indigo-400 dark:hover:ring-indigo-700 transition-shadow",style:{width:34,height:34},children:r})}),e.jsx(_t,{children:e.jsxs(y,{className:"p-0 pt-4 shadow-xl z-20",children:[e.jsxs(J,{children:[e.jsxs("a",{className:"flex items-center px-6 py-2 hover:bg-tremor-brand-faint hover:dark:bg-dark-tremor-brand-faint transition-colors no-underline",href:ve().replace(/\/api$/,"/docs"),target:"_blank",rel:"noopener noreferrer",children:[e.jsx(_,{icon:ws,color:"slate",className:"mr-3"}),e.jsx(c,{className:"flex-grow no-underline border-0",children:"REST API docs"}),e.jsx(_,{icon:M,color:"slate"})]}),e.jsxs("a",{className:"flex items-center px-6 py-2 hover:bg-tremor-brand-faint hover:dark:bg-dark-tremor-brand-faint transition-colors no-underline",href:"https://github.com/lucafaggianelli/plombery",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(_,{icon:Ts,color:"slate",className:"mr-3"}),e.jsx(c,{className:"flex-grow no-underline border-0",children:"GitHub"}),e.jsx(_,{icon:M,color:"slate"})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx(Lt,{}),t&&e.jsx(Ct,{})]})]})})]})},se=({children:s,header:t})=>e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-950 p-6 sm:p-10 min-h-screen",children:[e.jsxs(h,{className:"items-start gap-8",children:[t&&e.jsx("div",{className:"flex-grow max-w-full",children:t}),e.jsx(Rt,{})]}),e.jsx("main",{children:s})]}),V=({children:s,footer:t,isOpen:r,subtitle:n,title:a,onClose:i})=>e.jsx(ae,{show:r,as:l.Fragment,children:e.jsxs(ie,{onClose:i,className:"relative z-50",children:[e.jsx(ae.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/30 dark:bg-black/50 backdrop-blur-sm","aria-hidden":"true"})}),e.jsx("div",{className:"fixed inset-0 flex w-screen items-center justify-center p-12",children:e.jsx(ae.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-1/3",enterTo:"opacity-100 translate-y-0",leave:"ease-in duration-300",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 -translate-y-1/3",children:e.jsx(ie.Panel,{className:"max-w-full",children:e.jsxs(y,{children:[a&&e.jsx(ie.Title,{children:e.jsx(k,{children:a})}),n&&e.jsx(Q,{children:n}),e.jsx("div",{className:(a||n)&&"mt-6",children:s}),t&&e.jsx(h,{className:"justify-end space-x-6 mt-6",children:t})]})})})})]})}),Dt=({label:s,...t})=>{const r=l.createRef();return e.jsxs("div",{children:[e.jsx("input",{type:"range",onInput:n=>r.current&&(r.current.value=n.target.value),className:"w-full cursor-ew-resize appearance-none accent-indigo-500 h-2 bg-tremor-background border border-tremor-border dark:border-dark-tremor-border dark:bg-dark-tremor-background rounded",...t}),e.jsxs(D,{numItems:3,className:"items-baseline",children:[e.jsx(A,{children:e.jsxs("div",{className:"ml-1 inline-block",children:[e.jsx("div",{className:"border-r border-slate-300 dark:border-slate-600 h-2 mx-auto",style:{width:1}}),e.jsx(c,{children:t.min})]})}),e.jsx(h,{className:"justify-center",children:e.jsx(c,{children:e.jsx($,{children:e.jsx("output",{ref:r,className:"px-2 py-1 rounded bg-tremor-background-subtle dark:bg-dark-tremor-background-subtle block truncate text-center",children:t.defaultValue})})})}),e.jsx(h,{className:"justify-end",children:e.jsxs("div",{className:"mr-1",children:[e.jsx("div",{className:"border-r border-slate-300 dark:border-slate-600 h-2 mx-auto",style:{width:1}}),e.jsx(c,{children:t.max})]})})]})]})},$t={checkbox:s=>e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{id:s.name,name:s.name,type:"checkbox",defaultChecked:s.defaultValue==="true",className:"w-4 h-4 accent-indigo-500 bg-tremor-background rounded dark:bg-dark-tremor-background cursor-pointer"}),e.jsx("label",{htmlFor:s.name,className:"pl-2 cursor-pointer",children:e.jsx(c,{children:s.label})})]}),number:s=>{const t=s.value.minimum??s.value.exclusiveMinimum,r=s.value.maximum??s.value.exclusiveMaximum;return e.jsx(Ls,{name:s.name,min:t,max:r,defaultValue:s.defaultValue,required:s.required})},range:s=>{const t=s.value.minimum??s.value.exclusiveMinimum??0,r=s.value.maximum??s.value.exclusiveMaximum??0,n=s.type==="number"?(r-t)/10:1;return e.jsx(Dt,{name:s.name,label:s.label,min:t,max:r,step:n,defaultValue:s.defaultValue,required:s.required})},select:s=>{const[t,r]=l.useState(s.defaultValue||"");return e.jsxs("div",{children:[e.jsx(Rs,{defaultValue:s.defaultValue,onValueChange:r,value:t,children:s.value.enum.map(n=>e.jsx(Ds,{value:n.toString(),children:n==null?void 0:n.toString()},n==null?void 0:n.toString()))}),e.jsx("input",{type:"hidden",name:s.name,value:t})]})},text:s=>e.jsx($s,{name:s.name,placeholder:s.label,defaultValue:s.defaultValue})},Pt=s=>{let t="text";if(s.type==="number"||s.type==="integer"){const r=s.value.minimum??s.value.exclusiveMinimum,n=s.value.maximum??s.value.exclusiveMaximum;r!==void 0&&n!==void 0?t="range":t="number"}else s.type==="enum"?t="select":s.type==="boolean"&&(t="checkbox");return $t[t](s)},Ot=({errors:s={},schema:t})=>{const r=l.useCallback(i=>{const u=t.definitions||t.$defs;if(!u)return;const d=i.split("/").pop();return u[d]},[t]),n=t.properties;if(!n)return e.jsx(c,{className:"mt-4",children:"This pipeline has no input parameters, but you can still run it!"});const a=Object.entries(n).map(([i,u])=>{var w,f,m;if(typeof u=="boolean")return;let d=u,p;const o=d.title||i;if(u.allOf){const g=u.allOf[0];if(p=(w=u.default)==null?void 0:w.toString(),g.$ref){const b=r(g.$ref);b&&(d=b)}}else if(u.$ref){const g=r(u.$ref);g&&(d=g)}else p=(f=d.default)==null?void 0:f.toString();const x=(d.enum?"enum":Array.isArray(d.type)?d.type[0]:d.type)||"string",j=((m=t.required)==null?void 0:m.includes(i))??!1,S=Pt({defaultValue:p,label:o,name:i,required:j,type:x,value:d});return e.jsxs("div",{children:[e.jsxs(h,{className:"justify-between",children:[e.jsxs(c,{className:"mb-2",children:[o,j&&" *"]}),d.description&&e.jsx(_,{icon:Ve,tooltip:d.description,color:"neutral"})]}),S,s[i]&&e.jsx(c,{color:"rose",className:"mt-1",children:s[i]})]},i)});return e.jsx(h,{className:"gap-4 flex-col items-stretch",children:a})},Te=({pipeline:s})=>{var p;const[t,r]=l.useState(!1),n=W(),a=E({...ft(s.id),enabled:t}),i=Ue(Je(s.id)),u=i.isError&&i.error.status===422?Object.fromEntries(i.error.data.data.detail.map(o=>[o.loc.join("."),o.msg])):void 0,d=(p=i.error)==null?void 0:p.message;return e.jsxs(e.Fragment,{children:[e.jsx(N,{color:"indigo",variant:"secondary",size:"xs",icon:oe,onClick:()=>r(!0),children:"Run"}),e.jsx(V,{isOpen:t,title:`Run ${s.name} manually`,onClose:()=>r(!1),children:e.jsxs("form",{onSubmit:async o=>{o.preventDefault();const x=Object.fromEntries(new FormData(o.target).entries());try{const j=await i.mutateAsync(x);n(`/pipelines/${j.pipeline_id}/triggers/${j.trigger_id}/runs/${j.id}`),r(!1)}catch(j){console.error(j)}},children:[a.isLoading?"Loading...":a.isError?"Error":e.jsxs("div",{style:{width:350},children:[e.jsx(Ot,{schema:a.data,errors:u}),d&&e.jsx(c,{className:"mt-2",color:"rose",children:d})]}),e.jsxs(h,{className:"justify-end space-x-6 mt-6",children:[e.jsx(N,{type:"button",variant:"secondary",color:"indigo",onClick:()=>{r(!1)},disabled:i.isLoading,children:"Close"}),e.jsx(N,{color:"indigo",type:"submit",icon:oe,disabled:i.isLoading,children:"Run"})]})]})})]})},It=()=>{const s=E(pt());if(s.isLoading)return e.jsx("div",{children:"Loading..."});if(s.isError)return e.jsx("div",{children:"An error has occurred"});const t=s.data;return e.jsxs(y,{children:[e.jsx(k,{children:"Pipelines"}),e.jsxs(J,{children:[t.map(r=>{var n;return e.jsxs(F,{className:"gap-x-1",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(c,{className:"truncate",children:e.jsx($,{children:e.jsx(O,{to:`/pipelines/${r.id}`,children:r.name})})}),r.description&&e.jsx(c,{className:"truncate",children:r.description})]}),r.hasTrigger()&&e.jsxs("div",{className:"min-w-0",title:(n=r.getNextFireTime())==null?void 0:n.toString(),children:[e.jsx(c,{className:"truncate",children:"Next fire time"}),e.jsx(c,{className:"truncate",children:e.jsx($,{children:xe(r.getNextFireTime(),{addSuffix:!0,includeSeconds:!0})})})]}),e.jsx(Te,{pipeline:r})]},r.id)}),t.length===0&&e.jsxs("div",{className:"mt-4",children:[e.jsx(c,{className:"text-center italic",children:"There are no pipelines, you can't do much."}),e.jsx("div",{className:"text-center mt-2 text-sm",children:e.jsxs("a",{href:"https://lucafaggianelli.github.io/plombery/pipelines/",target:"_blank",className:"inline-flex items-center gap-2 bg-indigo-50/30 hover:bg-indigo-50 dark:bg-indigo-950/50 dark:hover:bg-indigo-950 rounded-sm px-4 py-2 text-indigo-500 transition-colors duration-300 cursor-pointer no-underline",rel:"noopener noreferrer",children:["How to create pipelines",e.jsx(_,{icon:M,size:"sm",className:"p-0",color:"indigo"})]})})]})]})]})},C=Ps(ht().toString(),{transports:["websocket"]}),Mt=()=>e.jsx("div",{className:"tremor-Badge-icon -ml-1 mr-1.5 h-4 w-4 animate-spin",children:e.jsx(Os,{})}),z={pending:"slate",completed:"emerald",failed:"rose",cancelled:"slate",running:"blue",warning:"amber"},de={pending:Is,completed:Ms,failed:ze,cancelled:As,running:Mt,warning:Fs},ue=["cyan","violet","pink","emerald","orange","stone","fuchsia"],Ze=s=>Object.fromEntries(s.map((t,r)=>[t.id,`bg-${ue[r%ue.length]}-500`])),B=(s,t=!1)=>{if(t){const r=qe(s,s.getTimezoneOffset());return H(r,"d MMM yyyy HH:mm:ss")+" (UTC)"}else return H(s,"d MMM yyyy HH:mm:ss (XXX)")},G=(s,t=!1)=>{if(t){const r=qe(s,s.getTimezoneOffset());return H(r,"HH:mm:ss.SSS")+" (UTC)"}else return H(s,"HH:mm:ss.SSS")},Oe=s=>H(s,"d MMM yyyy"),At=new Intl.NumberFormat,Ft=s=>At.format(s),es=({status:s})=>e.jsx(Be,{color:z[s],icon:de[s],children:s}),ss=({startTime:s})=>{const[t,r]=l.useState(Date.now()-s.getTime());return l.useEffect(()=>{const n=setInterval(()=>{r(Date.now()-s.getTime())},500);return()=>{clearInterval(n)}}),e.jsx("span",{children:(t/1e3).toFixed(2)})},Se=({query:s})=>s.isError?e.jsxs(e.Fragment,{children:[e.jsxs(h,{justifyContent:"start",children:[e.jsx(_,{icon:ze,color:"rose",className:"pl-0"}),e.jsx(k,{children:"Error fetching data"})]}),e.jsx(c,{children:s.error.message}),e.jsx(h,{justifyContent:"center",className:"mt-4",children:e.jsx(N,{color:"rose",variant:"light",size:"xs",onClick:()=>s.refetch(),children:"Retry"})})]}):null,te="animate-pulse rounded",re="bg-slate-200 dark:bg-slate-700",Ht=({className:s})=>e.jsx("div",{className:X("h-10",te,re,s)}),Vt=({className:s})=>e.jsx("div",{className:X("h-28",te,re,s)}),me=({className:s})=>e.jsx(c,{className:X(te,re,s),children:" "}),ts=({className:s})=>e.jsx(Y,{className:X("w-24",te,re,s),children:" "}),Ut=({columns:s=6,rows:t=10})=>new Array(t).fill(1).map((r,n)=>e.jsx(R,{className:"animate-pulse",children:new Array(s).fill(1).map((a,i)=>e.jsx(v,{children:e.jsx(me,{})},i))},n)),_e=({pipelineId:s,query:t,triggerId:r})=>{const[n,a]=l.useState(t.data||[]),i=he(),u=W(),d=l.useCallback(o=>{if(o.run.start_time=new Date(o.run.start_time),o.run.trigger_id=o.trigger,o.run.status==="running")a([o.run,...n]);else{let x=[...n];const j=x.findIndex(S=>S.id===o.run.id);j>=0?x[j]=o.run:x=[o.run,...x],a(x),i.invalidateQueries({queryKey:["runs",s,r]})}},[s,i,n,r]);l.useEffect(()=>(C.on("run-update",d),()=>{C.off("run-update",d)}),[s]),l.useEffect(()=>{var o;(o=t.data)!=null&&o.length&&a(t.data)},[t.data]);const p=4+ +!!s+ +!!r;return e.jsxs(y,{children:[e.jsx(k,{children:"Runs"}),e.jsxs(ge,{className:"overflow-auto max-h-[50vh]",children:[e.jsx(je,{className:"sticky top-0 bg-tremor-background dark:bg-dark-tremor-background shadow dark:shadow-tremor-dropdown z-10",children:e.jsxs(R,{children:[e.jsx(T,{className:"text-right",children:"#"}),e.jsx(T,{children:"Status"}),!s&&e.jsx(T,{children:"Pipeline"}),!r&&e.jsx(T,{children:"Trigger"}),e.jsx(T,{children:"Started at"}),e.jsx(T,{className:"text-right",children:"Duration"})]})}),e.jsxs(pe,{children:[n.map(o=>e.jsxs(R,{className:"cursor-pointer hover:bg-slate-50 dark:hover:bg-dark-tremor-background-subtle transition-colors",onClick:()=>u(`/pipelines/${o.pipeline_id}/triggers/${o.trigger_id}/runs/${o.id}`),children:[e.jsx(v,{className:"text-right",children:o.id}),e.jsx(v,{children:e.jsx(es,{status:o.status})}),!s&&e.jsx(v,{children:e.jsx(O,{to:`/pipelines/${o.pipeline_id}`,className:"link--arrow",title:"View pipeline details",onClick:x=>x.stopPropagation(),children:o.pipeline_id})}),!r&&e.jsx(v,{children:e.jsx(O,{to:`/pipelines/${o.pipeline_id}/triggers/${o.trigger_id}`,className:"link--arrow",title:"View trigger details",onClick:x=>x.stopPropagation(),children:o.trigger_id})}),e.jsx(v,{title:B(o.start_time,!0),children:e.jsx(c,{children:Hs(new Date,o.start_time)<=1?xe(o.start_time,{addSuffix:!0,includeSeconds:!0}):B(o.start_time)})}),e.jsxs(v,{className:"text-right",children:[o.status!=="running"?(o.duration/1e3).toFixed(2):e.jsx(ss,{startTime:o.start_time})," ","s"]})]},o.id)),(t.isFetching||t.isLoading)&&e.jsx(Ut,{columns:p}),t.isError&&e.jsx(R,{children:e.jsx(v,{colSpan:p,children:e.jsx(Se,{query:t})})})]})]})]})},qt=()=>{const s=E(ke());return e.jsx(se,{header:e.jsx(e.Fragment,{children:e.jsx(k,{children:"Plombery"})}),children:e.jsxs(D,{numItemsMd:2,className:"gap-6 mt-6",children:[e.jsx(A,{children:e.jsx(It,{})}),e.jsx(A,{children:e.jsx(_e,{query:s})})]})})},zt=()=>e.jsx("div",{className:"bg-slate-100 dark:bg-slate-950 h-screen flex justify-center items-center",children:e.jsxs(y,{className:"w-auto",children:[e.jsx("div",{className:"w-12 rounded-full mx-auto mb-4",children:e.jsx("img",{src:"/mario-pipe-flower.png",alt:"Plombery logo"})}),e.jsx(k,{className:"mb-6",children:"Welcome to Plombery"}),e.jsx(N,{onClick:()=>{location.href=`${ve()}/auth/login`},size:"lg",color:"indigo",className:"shadow-none w-full",children:"Login"})]})}),I=()=>e.jsx(c,{children:"/"}),Ce=({pipeline:s,trigger:t,run:r,className:n})=>{if(r&&!t)throw new Error;return e.jsxs(h,{className:`gap-x-2 justify-start flex-wrap ${n||""}`,children:[e.jsx(c,{children:e.jsx(O,{to:"/",children:"Pipelines"})}),e.jsx(I,{}),e.jsx(c,{children:t?e.jsx(O,{to:`/pipelines/${s.id}`,children:s.name}):s.name}),t&&e.jsxs(e.Fragment,{children:[e.jsx(I,{}),e.jsx(c,{children:"Triggers"}),e.jsx(I,{}),e.jsx(c,{children:r?e.jsx(O,{to:`/pipelines/${s.id}/triggers/${t.id}`,children:t.name}):t.name})]}),r&&t&&e.jsxs(e.Fragment,{children:[e.jsx(I,{}),e.jsx(c,{children:"Runs"}),e.jsx(I,{}),e.jsxs(c,{children:["#",r.id]})]})]})},Ie=s=>(s/1e3).toFixed(1)+" s",Bt=()=>e.jsxs(y,{children:[e.jsx(c,{children:"Duration (AVG)"}),e.jsx(ts,{}),e.jsx(Vt,{className:"mt-6"})]}),rs=({query:s})=>{if(s.isFetching||s.isLoading)return e.jsx(Bt,{});if(s.isError)return e.jsx(y,{children:e.jsx(Se,{query:s})});const t=s.data.filter(n=>n.status==="completed").reverse(),r=t.reduce((n,a)=>n+a.duration,0)/t.length||0;return e.jsxs(y,{children:[e.jsx(h,{className:"items-start",children:e.jsx(c,{children:"Duration (AVG)"})}),e.jsx(h,{className:"justify-start items-baseline space-x-3 truncate",children:e.jsx(Y,{children:Ie(r)})}),e.jsx(Vs,{data:t,index:"id",categories:["duration"],colors:["indigo"],valueFormatter:Ie,yAxisWidth:40,showLegend:!1,autoMinValue:!0,className:"mt-6 h-28"})]})},Gt=({subject:s})=>e.jsxs(y,{children:[e.jsx(c,{children:"Successful runs"}),e.jsx(ts,{}),e.jsxs(c,{className:"mt-4",children:[s," health"]}),e.jsx(Ht,{}),e.jsxs(h,{className:"mt-2",children:[e.jsx(me,{className:"w-20"}),e.jsx(me,{className:"w-20"})]})]}),ns=({query:s,subject:t})=>{var d,p;if(s.isLoading||s.isFetching)return e.jsx(Gt,{subject:t});if(s.isError)return e.jsx(y,{children:e.jsx(Se,{query:s})});const r=[...s.data].reverse(),a=r.filter(o=>o.status==="completed").length/r.length*100||0,i=(d=r[0])==null?void 0:d.start_time,u=(p=r[r.length-1])==null?void 0:p.start_time;return e.jsxs(y,{children:[e.jsx(h,{className:"items-start",children:e.jsx(c,{children:"Successful runs"})}),e.jsx(h,{className:"justify-start items-baseline space-x-3 truncate",children:e.jsxs(Y,{children:[a.toFixed(1)," ",e.jsx("span",{className:"text-lg",children:"%"})]})}),r.length?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"mt-4",children:e.jsxs(c,{children:[t," health"]})}),e.jsx(Us,{className:"mt-2",data:r.map(o=>({key:o.id,color:z[o.status],tooltip:`#${o.id} ${o.status}`}))})]}):e.jsx(c,{className:"text-center mt-8",children:e.jsxs(qs,{children:["This ",t.toLowerCase()," has no runs yet"]})}),e.jsxs(h,{className:"mt-2",children:[e.jsx(c,{children:i&&i.toDateString()}),e.jsx(c,{children:u&&u.toDateString()})]})]})},Kt=({pipeline:s})=>{const t=W();return e.jsxs(y,{children:[e.jsx(k,{children:"Triggers"}),e.jsxs(ge,{children:[e.jsx(je,{className:"sticky top-0 bg-tremor-background dark:bg-dark-tremor-background shadow dark:shadow-tremor-dropdown z-10",children:e.jsxs(R,{children:[e.jsx(T,{children:"Name"}),e.jsx(T,{children:"Interval"}),e.jsx(T,{children:"Next Fire Time"})]})}),e.jsxs(pe,{children:[s.triggers.map(r=>e.jsxs(R,{className:"cursor-pointer hover:bg-slate-50 dark:hover:bg-dark-tremor-background-subtle transition-colors",onClick:()=>t(`/pipelines/${s.id}/triggers/${r.id}`),children:[e.jsx(v,{children:r.name}),e.jsx(v,{children:e.jsx(c,{children:r.schedule})}),e.jsx(v,{children:xe(s.getNextFireTime(),{includeSeconds:!0,addSuffix:!0})})]},r.id)),s.triggers.length===0&&e.jsx(R,{children:e.jsxs(v,{colSpan:3,children:[e.jsx(c,{className:"text-center italic",children:"This pipeline has no triggers, can be run only manually."}),e.jsx("div",{className:"text-center mt-2 text-sm",children:e.jsxs("a",{href:"https://lucafaggianelli.github.io/plombery/triggers/",target:"_blank",className:"inline-flex items-center gap-2 bg-indigo-50/30 hover:bg-indigo-50 dark:bg-indigo-950/50 dark:hover:bg-indigo-950 rounded-sm px-4 py-2 text-indigo-500 transition-colors duration-300 cursor-pointer no-underline",rel:"noopener noreferrer",children:["How to create triggers",e.jsx(_,{icon:M,size:"sm",className:"p-0",color:"indigo"})]})})]})})]})]})]})},Qt=({className:s,content:t})=>{const[r,n]=l.useState(!1),a=l.useRef();return e.jsx(N,{variant:"light",color:"indigo",size:"sm",icon:r?zs:Bs,tooltip:"Click to copy",className:s,onClick:()=>{navigator.clipboard.writeText(t),n(!0),a.current=setTimeout(()=>n(!1),3e3)}})},as=({pipelineId:s,triggerId:t})=>{const[r,n]=l.useState(!1),a=document.documentElement.classList.contains("dark"),i=[{language:"python",name:"Python",code:`import httpx

httpx.post('${De(s)}', json={
  "pipeline_id": "${s}",${t?`
  "trigger_id": "${t}",`:""}
  "params": {
    "name": "value",
  }
})`},{language:"js",name:"JavaScript",code:`fetch('${De(s)}', {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    pipeline_id: '${s}',${t?`
    trigger_id: '${t}',`:""}
    params: {},
  }),
})`}];return e.jsxs(e.Fragment,{children:[e.jsx(N,{color:"indigo",variant:"secondary",size:"xs",icon:Ve,onClick:()=>n(!0)}),e.jsx(V,{isOpen:r,title:"Run via HTTP request",subtitle:"You can run pipelines and triggers via HTTP requests",onClose:()=>n(!1),children:e.jsxs(Fe,{children:[e.jsx(He,{className:"mt-8",children:i.map(u=>e.jsx(q,{children:u.name},u.name))}),e.jsx(Gs,{children:i.map(u=>e.jsx(Ks,{children:e.jsxs("div",{className:"mt-6 relative group",children:[e.jsx(Qs,{language:u.language,style:a?Js:Ws,customStyle:{borderRadius:8},children:u.code}),e.jsx(Qt,{content:u.code,className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-slate-200/80 dark:bg-slate-800/80 rounded p-2"})]})},u.name))})]})})]})},Jt=()=>{const t=fe().pipelineId,r=E(Ne(t)),n=E(ke(t));if(r.isLoading)return e.jsx("div",{children:"Loading..."});if(r.isError)return e.jsx("div",{children:"An error has occurred"});const a=r.data;return e.jsxs(se,{header:e.jsxs("div",{children:[e.jsxs(h,{className:"items-start",children:[e.jsxs(h,{className:"justify-start items-start md:items-center flex-col md:flex-row min-w-0",children:[e.jsxs(k,{className:"truncate max-w-full",children:["Pipeline ",a.name]}),a.description&&e.jsxs(c,{className:"truncate max-w-full",children:[e.jsx("span",{className:"hidden md:inline mx-2",children:"·"}),a.description]})]}),e.jsx(Te,{pipeline:a})]}),e.jsx(Ce,{pipeline:a,className:"mt-4"})]}),children:[e.jsxs(D,{numItemsMd:2,numItemsLg:3,className:"gap-6 mt-6",children:[e.jsxs(y,{className:"flex flex-col h-full",children:[e.jsx(k,{children:"Tasks"}),e.jsxs(J,{children:[a.tasks.map(i=>e.jsx(F,{children:e.jsxs("div",{children:[e.jsx(c,{children:e.jsx($,{children:i.name})}),i.description&&e.jsx(c,{className:"truncate",children:i.description})]})},i.id)),a.tasks.length===0&&e.jsxs("div",{className:"mt-4",children:[e.jsx(c,{className:"text-center italic",children:"This pipeline has no tasks so it can't be run."}),e.jsx("div",{className:"text-center mt-2 text-sm",children:e.jsxs("a",{href:"https://lucafaggianelli.github.io/plombery/tasks/",target:"_blank",className:"inline-flex items-center gap-2 bg-indigo-50/30 hover:bg-indigo-50 dark:bg-indigo-950/50 dark:hover:bg-indigo-950 rounded-sm px-4 py-2 text-indigo-500 transition-colors duration-300 cursor-pointer no-underline",rel:"noopener noreferrer",children:["How to create tasks",e.jsx(_,{icon:M,size:"sm",className:"p-0",color:"indigo"})]})})]})]}),e.jsx("div",{style:{flexGrow:1}}),e.jsxs(h,{className:"justify-between gap-8",children:[e.jsx(c,{children:"Run URL"}),e.jsx(as,{pipelineId:t})]})]}),e.jsx(ns,{subject:"Pipeline",query:n}),e.jsx(rs,{query:n})]}),e.jsxs(D,{numItems:1,numItemsSm:1,numItemsMd:1,numItemsLg:2,className:"gap-6 mt-6",children:[e.jsx(A,{children:e.jsx(Kt,{pipeline:a})}),e.jsx(A,{children:e.jsx(_e,{query:n,pipelineId:t})})]})]})},Wt=({trigger:s})=>{const[t,r]=l.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(N,{color:"indigo",variant:"light",size:"sm",icon:Xs,onClick:()=>r(!0),children:"Show params"}),e.jsx(V,{isOpen:t,title:"Trigger params",subtitle:s.name,footer:e.jsx(N,{variant:"primary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),onClose:()=>r(!1),children:e.jsx("pre",{className:"p-3 bg-slate-100 dark:bg-dark-tremor-background-subtle dark:text-dark-tremor-content-emphasis rounded-md",children:JSON.stringify(s.params,null,2)})})]})},K={id:"_manual",name:"Manual",description:"Special trigger that identifies pipelines run manually by the user"},Xt=()=>{const s=W(),t=fe(),r=t.pipelineId,n=t.triggerId,a=E(Ne(r)),i=E({...ke(r,n),enabled:!!n}),u=Ue({...Je(r,n),onSuccess(j){s(`/pipelines/${j.pipeline_id}/triggers/${j.trigger_id}/runs/${j.id}`)}});if(a.isLoading)return e.jsx("div",{children:"Loading..."});if(a.isError)return e.jsx("div",{children:"An error has occurred"});const d=a.data,p=n===K.id,o=p?K:d.triggers.find(j=>j.id===n);if(!o)return e.jsx("div",{children:"Trigger not found"});const x=p?e.jsx(Te,{pipeline:d}):e.jsx(N,{size:"xs",color:"indigo",variant:"secondary",icon:oe,onClick:()=>{u.mutateAsync()},children:"Run"});return e.jsxs(se,{header:e.jsxs("div",{children:[e.jsxs(h,{className:"items-start",children:[e.jsxs(h,{className:"justify-start items-start md:items-center flex-col md:flex-row min-w-0",children:[e.jsxs(k,{className:"truncate max-w-full",children:["Trigger ",o.name]}),o.description&&e.jsxs(c,{className:"truncate max-w-full",children:[e.jsx("span",{className:"hidden md:inline mx-2",children:"·"}),o.description]})]}),x]}),e.jsx(Ce,{pipeline:d,trigger:o,className:"mt-4"})]}),children:[e.jsxs(D,{numItemsMd:2,numItemsLg:3,className:"gap-6 mt-6",children:[e.jsxs(y,{className:"flex flex-col h-full",children:[e.jsx(k,{children:o.name}),e.jsx(Q,{children:o.description}),e.jsx("div",{style:{flexGrow:1}}),e.jsxs(F,{children:[e.jsx(c,{children:"Schedule"}),e.jsx(c,{children:e.jsx($,{children:o.schedule})})]}),e.jsxs(F,{children:[e.jsx(c,{children:"Params"}),o.params?e.jsx(Wt,{trigger:o}):e.jsx(c,{children:e.jsx("em",{children:"No params"})})]}),e.jsxs(h,{className:"",children:[e.jsx(c,{children:"Run URL"}),e.jsx(as,{pipelineId:r,triggerId:n})]})]}),e.jsx(ns,{subject:"Trigger",query:i}),e.jsx(rs,{query:i})]}),e.jsx("div",{className:"mt-6",children:e.jsx(_e,{query:i,pipelineId:r,triggerId:n})})]})},Yt=({logEntry:s})=>{const[t,r]=l.useState(!1);return e.jsxs(h,{className:"mt-1",children:[e.jsx(N,{color:"rose",variant:"secondary",size:"xs",onClick:()=>r(!0),children:"Traceback info"}),e.jsx(V,{isOpen:t,title:"Traceback info",footer:e.jsx(N,{variant:"primary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),onClose:()=>r(!1),children:e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{style:{minWidth:350,maxWidth:"100%",overflow:"auto",flexGrow:1,maxHeight:"70vh"},className:"p-3 my-3 bg-tremor-background-subtle dark:bg-dark-tremor-background-subtle rounded-md whitespace-pre font-mono",children:s.exc_info})})})]})},Zt=30,Me={DEBUG:"slate",INFO:"sky",WARNING:"amber",ERROR:"rose"},er=({pipeline:s,run:t})=>{const[r,n]=l.useState({levels:[],tasks:[]}),[a,i]=l.useState(!0),u=he(),d=l.createRef(),p=E(bt(t.id)),o=l.useCallback(m=>{u.setQueryData(["logs",t.id],(g=[])=>{const b=JSON.parse(m);return b.id=g.length,b.timestamp=new Date(b.timestamp),[...g,b]})},[t.id]),x=l.useCallback(m=>{var Ee;const g=(Ee=d.current)==null?void 0:Ee.parentElement;if(!g)return;const b=m;let L=Math.max(g.scrollTop+g.clientHeight+b.deltaY,0);L=Math.min(L,g.scrollHeight);const is=g.scrollHeight-L<Zt;i(is)},[d]);l.useEffect(()=>{var m,g;return(g=(m=d.current)==null?void 0:m.parentElement)==null||g.addEventListener("wheel",x),()=>{var b,L;(L=(b=d.current)==null?void 0:b.parentElement)==null||L.removeEventListener("wheel",x)}},[d]),l.useEffect(()=>{var m;if(a){const g=(m=d.current)==null?void 0:m.parentElement;g==null||g.scrollTo({top:g.scrollHeight,behavior:"smooth"})}}),l.useEffect(()=>(C.on(`logs.${t.id}`,o),()=>{C.off(`logs.${t.id}`,o)}),[]);const j=l.useCallback(m=>{n(g=>({...g,...m}))},[]);if(p.isLoading)return e.jsx("div",{children:"Loading..."});if(p.isError)return e.jsx("div",{children:"Error loading logs"});const S=p.data.filter(m=>(r.levels.length===0||r.levels.includes(m.level))&&(r.tasks.length===0||r.tasks.includes(m.task))),w=Ze(s.tasks),f=["running","pending"].includes(t.status);return e.jsxs(h,{flexDirection:"col",alignItems:"stretch",style:{maxHeight:600},children:[e.jsxs(D,{numItemsMd:3,className:"gap-6 items-start",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Tasks"}),e.jsx(Le,{className:"mt-1 z-20",onValueChange:m=>{j({tasks:m})},children:s.tasks.map(m=>e.jsx(Re,{value:m.id,children:m.name},m.id))})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Log level"}),e.jsx(Le,{className:"mt-1 z-20",onValueChange:m=>{j({levels:m})},children:Object.keys(Me).map(m=>e.jsx(Re,{value:m},m))})]}),f&&e.jsxs(h,{justifyContent:"end",className:"order-first md:order-last",children:[e.jsx(_,{icon:Ys,variant:"light",color:a?"indigo":"gray",tooltip:"Automatically scroll to the latest logs. Click to toggle",className:"mr-4",style:{cursor:"pointer"},onClick:()=>{i(!a)}}),e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-indigo-500"})]}),e.jsx(c,{className:"ml-2 opacity-80",children:"Live logs"})]})]}),e.jsxs(ge,{className:"mt-6 flex-grow",ref:d,children:[e.jsx(je,{className:"sticky top-0 bg-tremor-background dark:bg-dark-tremor-background shadow dark:shadow-tremor-dropdown z-10",children:e.jsxs(R,{children:[e.jsx(T,{children:"Time"}),e.jsx(T,{children:"Level"}),e.jsx(T,{children:"Task"}),e.jsx(T,{children:"Message"})]})}),e.jsx(pe,{children:S.map((m,g)=>{const b=g!==0?m.timestamp.getTime()-S[g-1].timestamp.getTime():-1;return e.jsxs(R,{children:[e.jsx(v,{children:e.jsxs(c,{className:"font-mono text-xs",children:[e.jsx("span",{title:G(m.timestamp,!0),children:G(m.timestamp)}),b>=0&&e.jsxs("span",{className:"text-slate-400 ml-2",children:["+",Ft(b)," ms"]})]})}),e.jsx(v,{children:e.jsx(Be,{size:"xs",color:Me[m.level],children:m.level})}),e.jsx(v,{children:e.jsxs(h,{children:[e.jsx("div",{className:`h-2 w-2 mr-2 rounded-full ${w[m.task]}`}),m.task]})}),e.jsxs(v,{className:"w-full",children:[e.jsx(c,{children:m.message}),m.exc_info&&e.jsx(Yt,{logEntry:m})]})]},m.id)})})]})]})},sr=be.lazy(()=>Ge(()=>import("./HandsonTable-9590d098.js"),["assets/HandsonTable-9590d098.js","assets/vendor-0e4b1091.js","assets/HandsonTable-3e538464.css"])),tr=be.lazy(()=>Ge(()=>import("./main-3729f5f0.js").then(s=>s.m),["assets/main-3729f5f0.js","assets/vendor-0e4b1091.js"])),rr=({data:s})=>{const t=document.documentElement.classList.contains("dark");return e.jsx("div",{className:"border dark:border-slate-800 rounded-lg",children:e.jsx(l.Suspense,{fallback:e.jsx("div",{children:"Loading table UI..."}),children:e.jsx(tr,{src:s,collapseStringsAfterLength:50,iconStyle:"triangle",theme:t?"summerfruit":"summerfruit:inverted",style:{padding:24,borderRadius:"inherit"}})})})},nr=({data:s})=>e.jsx("div",{className:"border dark:border-slate-800 rounded-lg p-6",children:JSON.stringify(s)}),ar=({data:s})=>Array.isArray(s)&&typeof s[0]=="object"?e.jsx(l.Suspense,{fallback:e.jsx("div",{children:"Loading table UI..."}),children:e.jsx(sr,{data:s,rowHeaders:!0,colHeaders:Object.keys(s[0]),height:"70vh",width:"700px",licenseKey:"non-commercial-and-evaluation"})}):typeof s=="object"&&s!==null?e.jsx(rr,{data:s}):e.jsx(nr,{data:s}),ir=({runId:s,taskId:t,open:r,onClose:n})=>{const a=E({...yt(s,t),enabled:r});return e.jsx(e.Fragment,{children:e.jsxs(V,{title:t,subtitle:"View data",isOpen:r,footer:e.jsxs(e.Fragment,{children:[e.jsx(N,{variant:"secondary",color:"indigo",onClick:()=>n(),children:"Close"}),e.jsxs("a",{href:`${ve()}/${Qe(s,t)}`,target:"_blank",className:"tremor-Button-root flex-shrink-0 inline-flex justify-center items-center group font-medium outline-none rounded-tremor-default shadow-tremor-input dark:shadow-dark-tremor-input border px-4 py-2 text-sm bg-indigo-500 border-indigo-500 text-white hover:bg-indigo-600 hover:border-indigo-700 no-underline hover:text-inherit",rel:"noopener noreferrer",children:[e.jsx(Zs,{className:"tremor-Button-icon shrink-0 h-5 w-5 -ml-1 mr-1.5"}),"Download"]})]}),onClose:n,children:[a.isLoading&&e.jsx("div",{children:"Loading..."}),a.isError&&(a.error.response.status===404?e.jsx(c,{children:"The task has no data"}):e.jsxs(c,{color:"rose",children:["Error fetching task data: ",a.error.message]})),!a.isLoading&&!a.isError&&e.jsx(ar,{data:a.data})]})})},or=({pipeline:s,run:t})=>{const[r,n]=l.useState(),a=Ze(s.tasks);return e.jsxs(y,{children:[e.jsx(ir,{runId:t.id,taskId:r||"",open:!!r,onClose:()=>n(void 0)}),e.jsx(k,{children:"Tasks"}),e.jsx(J,{children:s.tasks.map((i,u)=>{var d;return e.jsxs(F,{className:"space-x-4",children:[t.tasks_run&&t.tasks_run[u]?e.jsx(_,{variant:"light",icon:de[t.tasks_run[u].status],color:z[t.tasks_run[u].status]}):e.jsx(_,{variant:"light",icon:de.pending,color:z.pending}),e.jsxs("div",{className:"truncate flex-grow",children:[e.jsxs(h,{className:"justify-start",children:[e.jsx("div",{className:`h-2 w-2 mr-2 rounded-full ${a[i.id]}`}),e.jsx(Q,{className:"truncate text-base text-tremor-content-emphasis dark:text-dark-tremor-content-emphasis",children:i.name})]}),i.description&&e.jsx(c,{className:"truncate",children:i.description})]}),t.tasks_run&&((d=t.tasks_run[u])==null?void 0:d.has_output)&&e.jsx(N,{variant:"light",color:"indigo",size:"xs",icon:et,onClick:()=>n(i.id),children:"Data"})]},i.id)})})]})},cr=()=>{const s=he(),t=fe(),r=t.pipelineId,n=t.triggerId,a=parseInt(t.runId);l.useEffect(()=>{const f=()=>{s.invalidateQueries({queryKey:$e(r,n,a).queryKey})};return C.on("run-update",f),()=>{C.off("run-update",f)}},[r]);const i=E(Ne(r)),u=E($e(r,n,a));if(i.isLoading)return e.jsx("div",{children:"Loading..."});if(i.isError)return e.jsx("div",{children:"Error"});const d=i.data,o=n===K.id?K:d.triggers.find(f=>f.id===n),x=u.data;if(!x)return e.jsx("div",{children:"Run not found"});if(!o)return e.jsx("div",{children:"Trigger not found"});const j=(x.tasks_run||[]).reduce((f,m)=>f+m.duration,0),S=(x.tasks_run||[]).map(f=>j?f.duration/j*100:0),w=st(x.start_time,x.duration);return e.jsxs(se,{header:e.jsxs(e.Fragment,{children:[e.jsxs(k,{children:["Run #",a]}),e.jsx(Ce,{pipeline:d,trigger:o,run:x})]}),children:[e.jsxs(D,{numItemsMd:3,className:"gap-6 mt-6",children:[e.jsx(or,{pipeline:d,run:x}),e.jsxs(y,{children:[e.jsxs(h,{className:"items-start",children:[e.jsx(c,{children:"Duration"}),e.jsx(es,{status:x.status})]}),e.jsx(h,{className:"justify-start items-baseline space-x-3 truncate",children:e.jsxs(Y,{children:[x.status!=="running"?(x.duration/1e3).toFixed(2):e.jsx(ss,{startTime:x.start_time})," ","s"]})}),e.jsx(tt,{values:S,colors:ue,showLabels:!1,className:"mt-3"}),e.jsxs(h,{alignItems:"start",className:"mt-2",children:[e.jsxs("div",{children:[e.jsx(c,{children:e.jsx($,{title:B(x.start_time,!0),children:G(x.start_time)})}),e.jsx(c,{className:"mt-1",children:Oe(x.start_time)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(c,{children:e.jsx($,{title:B(w,!0),children:G(w)})}),!rt(x.start_time,w)&&e.jsx(c,{children:Oe(w)})]})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(y,{children:e.jsx(er,{pipeline:d,run:x})})})]})},lr=({children:s})=>{const{isAuthenticated:t,isLoading:r}=we(),n=nt();return!t&&!r?e.jsx(at,{to:"/login",replace:!0,state:{from:n}}):e.jsx(e.Fragment,{children:s})},dr=Object.assign({"./pages/index.tsx":qt,"./pages/login.tsx":zt,"./pages/pipelines/[pipelineId]/index.tsx":Jt,"./pages/pipelines/[pipelineId]/triggers/[triggerId]/index.tsx":Xt,"./pages/pipelines/[pipelineId]/triggers/[triggerId]/runs/[runId]/index.tsx":cr}),ur=Object.entries(dr).map(([s,t])=>{const r=s.slice(7).replace(/(index)?\.tsx$/,"").split("/").map(n=>n.replace(/\[(.+)\]/,":$1")).join("/");return{path:r,element:r!=="/login"?e.jsx(lr,{children:e.jsx(t,{})}):e.jsx(t,{})}}),mr=()=>e.jsx(it,{children:ur.map(s=>e.jsx(ot,{path:s.path,element:s.element},s.path))}),xr=({children:s})=>{const[t,r]=l.useState(C.connected);return l.useEffect(()=>{function n(){r(!0)}function a(){r(!1)}return C.on("connect",n),C.on("disconnect",a),()=>{C.off("connect",n),C.off("disconnect",a)}},[]),s},hr=new ct({defaultOptions:{queries:{retry:!1}}});function gr(){return e.jsx(lt,{client:hr,children:e.jsx(xr,{children:e.jsx(dt,{children:e.jsx(Nt,{children:e.jsx(mr,{})})})})})}ut.createRoot(document.getElementById("root")).render(e.jsx(be.StrictMode,{children:e.jsx(gr,{})}));
