[tool.poetry]
name = "mlfoundry"
version = "0.11.1rc1" # do not change, auto-generated by poetry-dynamic-versioning
description = "Truefoundry's Experiment Tracking, Model Registry and Model Monitoring Library"
authors = ["Abhishek Choudhary <abhichoudhary06@gmail.com>"]
homepage = "https://truefoundry.com"
repository = "https://github.com/truefoundry/mlfoundry"
readme = "README.md"
packages = [
    { include = "mlfoundry" },
]

[tool.poetry.dependencies]
# Note: Do not use ^ or ~. They can cause unecessary confusion
# TODO (chiragjn): Ideally no upper limit should be put on packages because that makes
#    upgrading impossible for users, even if they only want partial compatible features
python = ">=3.8,<4"
GitPython = ">=3.1.41,<4.0.0"
PyJWT = ">=2.4.0,<3.0.0"
click = ">=8.0.0,<9.0.0"
coolname = ">=1.1.0,<2.0.0"
filelock = ">=3.8.0,<4.0.0"
psutil = ">=5.9.0,<7.0.0"
pydantic = ">=1.8.2,<3.0.0"
rich = ">=13.7,<14.0"
tfy-mlflow-client = "0.0.49"
tqdm = ">=4.62.3,<5.0.0"
urllib3 = ">=1.26.18,<3"
# Check and try to eliminate libs below this comment
importlib-metadata = ">=4.11.3,<8.0.0"
numpy = ">=1.23.0,<2.0.0"
pandas = [
    # This is split into two because poetry will select a version which has no wheel on python >= 3.10 :/
    { version = ">=1.0.0,<3.0.0", python = "<3.10" },
    { version = ">=1.4.0,<3.0.0", python = ">=3.10" },
]
scikit-learn =  [
    # This is split into two because poetry will select a version which has no wheel on python >= 3.10 :/
    { version = ">=0.24.2,<2.0.0", python = "<3.10" },
    { version = ">=1.0.2,<3.0.0", python = ">=3.10" },
]

[tool.poetry.dev-dependencies]
pre-commit = "2.21.0"
pytest = ">=7.2.0,<7.3.0"
Pillow = ">=9.1.1,<11.0.0"
doq = ">=0.9.1,<1.0.0"
ipython = ">=7.10.0"
ipykernel = ">=6.16.0"
lazydocs = ">=0.4.8,<0.5.0"
matplotlib = ">=3.0.0,<4.0.0"
mypy = ">=0.950"
plotly = ">=5.8.2"
shap = ">=0.40.0"
# TODO (chiragjn): As of 27th March, 2023 `tensorflow-io-gcs-filesystem` has upper limit 3.11
#   Adding python version limits us to running specific tests Python < 3.12
tensorflow-io-gcs-filesystem = [
    { version = "<0.32", platform = "win32", python = "<3.12"  },
]
tensorflow = ">=2.13.0,<3.0.0"
# Fix for running tests on mac https://github.com/python-poetry/poetry/issues/8271#issuecomment-1962406720
tensorflow-macos = { version = "==2.13.0", markers = "sys_platform == 'darwin' and platform_machine == 'arm64'" }
tensorflow-intel = [
    # This is split into two because poetry will select a version which has no wheel on python >= 3.10 :/
    { version = "<2.13.1", platform = "win32", python = "<3.9" },
    { version = ">=2.13.0,<3.0.0", platform = "win32", python = ">=3.9" }
]
transformers = ">=4.36.0,<5.0.0"
torch = [
  { version = "2.1.1+cpu", source = "torch", markers = "sys_platform != 'darwin'" },
  { version = "2.1.1", source = "pypi", markers = "sys_platform == 'darwin'" }
]


[[tool.poetry.source]]
name = "pypi"
priority = "primary"

[[tool.poetry.source]]
name = "torch"
url = "https://download.pytorch.org/whl/cpu"
priority = "explicit"

[tool.poetry-dynamic-versioning]
enable = false

[tool.poetry.plugins."console_scripts"]
mlfoundry = "mlfoundry.cli.cli_interface:create_mlfoundry_cli"

[tool.black]
line-length = 88
safe = true
target_version = ["py38", "py39", "py310"]

[tool.isort]
profile = "black"

[build-system]
requires = ["poetry-core>=1.0.0", "poetry-dynamic-versioning"]
build-backend = "poetry.core.masonry.api"

[tool.pytest.ini_options]
markers = [
    "uses_tf: marks tests that import and use tensorflow"
]
