{"version":3,"file":"14.6c7f7a62.js","sources":["../../../../../../src/routes/(app)/workspace/functions/create/+page.svelte"],"sourcesContent":["<script>\n\timport { toast } from 'svelte-sonner';\n\timport { onMount, getContext } from 'svelte';\n\timport { goto } from '$app/navigation';\n\n\timport { functions, models } from '$lib/stores';\n\timport { createNewFunction, getFunctions } from '$lib/apis/functions';\n\timport FunctionEditor from '$lib/components/workspace/Functions/FunctionEditor.svelte';\n\timport { getModels } from '$lib/apis';\n\n\tconst i18n = getContext('i18n');\n\n\tlet mounted = false;\n\tlet clone = false;\n\tlet func = null;\n\n\tconst saveHandler = async (data) => {\n\t\tconsole.log(data);\n\t\tconst res = await createNewFunction(localStorage.token, {\n\t\t\tid: data.id,\n\t\t\tname: data.name,\n\t\t\tmeta: data.meta,\n\t\t\tcontent: data.content\n\t\t}).catch((error) => {\n\t\t\ttoast.error(error);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\ttoast.success($i18n.t('Function created successfully'));\n\t\t\tfunctions.set(await getFunctions(localStorage.token));\n\t\t\tmodels.set(await getModels(localStorage.token));\n\n\t\t\tawait goto('/workspace/functions');\n\t\t}\n\t};\n\n\tonMount(() => {\n\t\twindow.addEventListener('message', async (event) => {\n\t\t\tif (\n\t\t\t\t!['https://openwebui.com', 'https://www.openwebui.com', 'http://localhost:9999'].includes(\n\t\t\t\t\tevent.origin\n\t\t\t\t)\n\t\t\t)\n\t\t\t\treturn;\n\n\t\t\tfunc = JSON.parse(event.data);\n\t\t\tconsole.log(func);\n\t\t});\n\n\t\tif (window.opener ?? false) {\n\t\t\twindow.opener.postMessage('loaded', '*');\n\t\t}\n\n\t\tif (sessionStorage.function) {\n\t\t\tfunc = JSON.parse(sessionStorage.function);\n\t\t\tsessionStorage.removeItem('function');\n\n\t\t\tconsole.log(func);\n\t\t\tclone = true;\n\t\t}\n\n\t\tmounted = true;\n\t});\n</script>\n\n{#if mounted}\n\t{#key func?.content}\n\t\t<FunctionEditor\n\t\t\tid={func?.id ?? ''}\n\t\t\tname={func?.name ?? ''}\n\t\t\tmeta={func?.meta ?? { description: '' }}\n\t\t\tcontent={func?.content ?? ''}\n\t\t\t{clone}\n\t\t\ton:save={(e) => {\n\t\t\t\tsaveHandler(e.detail);\n\t\t\t}}\n\t\t/>\n\t{/key}\n{/if}\n"],"names":["previous_key","_a","ctx","dirty","safe_not_equal","_b","_c","_d","functioneditor_changes","create_if_block","i18n","getContext","mounted","clone","func","saveHandler","data","createNewFunction","error","toast","$i18n","functions","getFunctions","models","getModels","goto","onMount","event","$$invalidate","e"],"mappings":"okBAmEO,IAAAA,GAAAC,EAAAC,OAAA,YAAAD,EAAM,0GAANE,EAAA,GAAAC,EAAAJ,EAAAA,GAAAC,EAAAC,OAAA,YAAAD,EAAM,OAAO,kMAEbA,EAAAC,EAAI,CAAA,IAAJ,YAAAD,EAAM,KAAM,UACVI,EAAAH,EAAI,CAAA,IAAJ,YAAAG,EAAM,OAAQ,GACd,OAAAC,EAAAJ,EAAM,CAAA,IAAN,YAAAI,EAAM,OAAU,CAAA,YAAa,EAAE,YAC5BC,EAAAL,EAAI,CAAA,IAAJ,YAAAK,EAAM,UAAW,qJAHtBN,EAAAC,EAAI,CAAA,IAAJ,YAAAD,EAAM,KAAM,mBACVI,EAAAH,EAAI,CAAA,IAAJ,YAAAG,EAAM,OAAQ,IACdF,EAAA,IAAAK,EAAA,OAAAF,EAAAJ,EAAM,CAAA,IAAN,YAAAI,EAAM,OAAU,CAAA,YAAa,EAAE,qBAC5BC,EAAAL,EAAI,CAAA,IAAJ,YAAAK,EAAM,UAAW,0IANxBL,EAAO,CAAA,GAAAO,EAAAP,CAAA,8FAAPA,EAAO,CAAA,qMAxDLQ,EAAOC,EAAW,MAAM,qBAE1B,IAAAC,EAAU,GACVC,EAAQ,GACRC,EAAO,KAEL,MAAAC,QAAqBC,GAAI,CAC9B,QAAQ,IAAIA,CAAI,EACE,MAAAC,EAAkB,aAAa,MAAK,CACrD,GAAID,EAAK,GACT,KAAMA,EAAK,KACX,KAAMA,EAAK,KACX,QAASA,EAAK,OACZ,CAAA,EAAA,MAAOE,IACTC,EAAM,MAAMD,CAAK,EACV,SAIPC,EAAM,QAAQC,EAAM,EAAE,+BAA+B,CAAA,EACrDC,EAAU,IAAG,MAAOC,EAAa,aAAa,KAAK,CAAA,EACnDC,EAAO,IAAG,MAAOC,EAAU,aAAa,KAAK,CAAA,EAEvC,MAAAC,EAAK,sBAAsB,IAInC,OAAAC,EAAO,IAAA,CACN,OAAO,iBAAiB,gBAAkBC,GAAK,EAE3C,wBAAyB,4BAA6B,yBAAyB,SAChFA,EAAM,MAAA,IAKRC,EAAA,EAAAd,EAAO,KAAK,MAAMa,EAAM,IAAI,CAAA,EAC5B,QAAQ,IAAIb,CAAI,MAGb,OAAO,QAAU,KACpB,OAAO,OAAO,YAAY,SAAU,GAAG,EAGpC,eAAe,WAClBc,EAAA,EAAAd,EAAO,KAAK,MAAM,eAAe,QAAQ,CAAA,EACzC,eAAe,WAAW,UAAU,EAEpC,QAAQ,IAAIA,CAAI,EAChBc,EAAA,EAAAf,EAAQ,EAAI,GAGbe,EAAA,EAAAhB,EAAU,EAAI,eAYHiB,GAAC,CACVd,EAAYc,EAAE,MAAM"}