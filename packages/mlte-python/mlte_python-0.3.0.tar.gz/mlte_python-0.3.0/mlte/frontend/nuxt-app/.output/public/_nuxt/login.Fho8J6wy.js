import{n as C,u as a,r as _,q as x,A as V,w as l,B as U,o as B,a as p,b as f,d,y as c,C as E,D as T,E as A,z as q}from"./entry.DufkozSH.js";import{r as I}from"./util.CdFxTbte.js";import{r as R,h as b}from"./http-error-handling.BbcmLHJS.js";const L={style:{"max-width":"30rem"}},N=p("h1",{class:"section-header"},"Login to MLTE",-1),P={class:"margin-button centered-container"},D=C({__name:"login",setup($){const v=q();a("token"),a("user"),a("userRole");const n=_(""),i=_(""),s=_({username:!1,password:!1});async function g(){s.value=I(s.value);let m=!1;if(n.value.trim()===""&&(s.value.username=!0,m=!0),i.value.trim()===""&&(s.value.password=!0,m=!0),m)return;const r={grant_type:"password",username:n.value,password:i.value};let o=[];for(const u in r){const e=encodeURIComponent(u),t=encodeURIComponent(r[u]);o.push(e+"="+t)}o=o.join("&");try{await $fetch(v.public.apiPath+"/token",{retry:0,method:"POST",headers:{accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},body:o,onRequestError(){R()},onResponse({response:e}){var w,y,h;const t=a("token",{secure:!0,maxAge:(w=e==null?void 0:e._data)==null?void 0:w.expires_in}),k=a("user",{maxAge:(y=e==null?void 0:e._data)==null?void 0:y.expires_in});t.value=(h=e==null?void 0:e._data)==null?void 0:h.access_token,k.value=n.value},onResponseError({response:e}){b(e.status,e._data.error_description)}});const u=a("token");await $fetch(v.public.apiPath+"/user/me",{retry:0,method:"GET",headers:{Authorization:"Bearer "+u.value},onRequestError(){R()},onResponse({response:e}){const t=a("userRole");t.value=e._data.role},onResponseError({response:e}){b(e.status,e._data.error_description)}}),A("/")}catch{return}}return(m,r)=>{const o=x("UsaTextInput"),u=x("UsaButton"),e=U;return B(),V(e,{name:"base-layout"},{default:l(()=>[p("form",null,[p("div",L,[N,f(o,{modelValue:c(n),"onUpdate:modelValue":r[0]||(r[0]=t=>E(n)?n.value=t:null),error:c(s).username},{label:l(()=>[d(" Username ")]),"error-message":l(()=>[d(" Enter a username ")]),_:1},8,["modelValue","error"]),f(o,{modelValue:c(i),"onUpdate:modelValue":r[1]||(r[1]=t=>E(i)?i.value=t:null),error:c(s).password,type:"password"},{label:l(()=>[d(" Password ")]),"error-message":l(()=>[d(" Enter a password ")]),_:1},8,["modelValue","error"]),p("div",P,[f(u,{type:"submit",class:"primary-button",onClick:r[2]||(r[2]=T(t=>g(),["prevent"]))},{default:l(()=>[d(" Login ")]),_:1})])])])]),_:1})}}});export{D as default};
