import{n as F,u as V,v as R,r as _,q as k,A as T,w as o,B as q,o as w,a as f,t as A,y as a,c as b,b as n,d as s,x as y,C as E,z as S,E as $}from"./entry.DufkozSH.js";import{u as z}from"./fetch.BKmV86es.js";import{r as I}from"./util.CdFxTbte.js";import{r as L,h as D}from"./http-error-handling.BbcmLHJS.js";import{c as G}from"./form-methods.CNbtV1xJ.js";const H={class:"flex-container"},j={class:"flex-container"},J={class:"section-header"},K={class:"centered-container",style:{"vertical-align":"bottom","padding-left":"38ch"}},M={key:0},O={key:1},Q={key:0},W={class:"submit-footer"},se=F({__name:"profile-edit",async setup(X){let p,h;const C=S(),P=V("token"),g=V("user"),{data:r}=([p,h]=R(()=>z(C.public.apiPath+"/user/me",{retry:0,method:"GET",headers:{Authorization:"Bearer "+P.value}},"$TnEsnvB9L2")),p=await p,h(),p),u=_(!1),l=_(""),d=_(""),m=_({password:!1,confirmPassword:!1});function B(){l.value="",d.value="",u.value=!0}function x(){u.value=!1,l.value="",d.value=""}async function U(){m.value=I(m.value);let c=!1;if(u.value&&(l.value.trim()===""&&(m.value.password=!0,c=!0),l.value!==d.value&&(m.value.confirmPassword=!0,c=!0)),!c)try{let e={username:r.value.username,email:r.value.email,full_name:r.value.full_name,disabled:!1,role:r.value.role};u.value&&(e.password=l.value),await $fetch(C.public.apiPath+"/user",{retry:0,method:"PUT",headers:{Authorization:"Bearer "+P.value},body:e,onRequestError(){L()},onResponse(){$("/")},onResponseError({response:i}){D(i.status,i._data.error_description)}})}catch{return}}return(c,e)=>{const i=k("UsaButton"),v=k("UsaTextInput"),N=q;return w(),T(N,{name:"base-layout"},{default:o(()=>[f("div",H,[f("div",j,[f("h1",J,A(a(g)),1),f("div",K,[a(u)?y("",!0):(w(),b("div",M,[n(i,{class:"secondary-button",onClick:B},{default:o(()=>[s(" Change Password ")]),_:1})])),a(u)?(w(),b("div",O,[n(i,{class:"secondary-button",onClick:x},{default:o(()=>[s(" Cancel Change ")]),_:1})])):y("",!0)])])]),a(u)?(w(),b("div",Q,[n(v,{modelValue:a(l),"onUpdate:modelValue":e[0]||(e[0]=t=>E(l)?l.value=t:null),error:a(m).password,type:"password"},{label:o(()=>[s(" New Password ")]),"error-message":o(()=>[s(" Password is required ")]),_:1},8,["modelValue","error"]),n(v,{modelValue:a(d),"onUpdate:modelValue":e[1]||(e[1]=t=>E(d)?d.value=t:null),error:a(m).confirmPassword,type:"password"},{label:o(()=>[s(" Confirm New Password ")]),"error-message":o(()=>[s(" Passwords to not match ")]),_:1},8,["modelValue","error"])])):y("",!0),n(v,{modelValue:a(r).email,"onUpdate:modelValue":e[2]||(e[2]=t=>a(r).email=t)},{label:o(()=>[s(" Email ")]),_:1},8,["modelValue"]),n(v,{modelValue:a(r).full_name,"onUpdate:modelValue":e[3]||(e[3]=t=>a(r).full_name=t)},{label:o(()=>[s(" Full Name ")]),_:1},8,["modelValue"]),f("div",W,[n(i,{class:"primary-button",onClick:e[4]||(e[4]=t=>("cancelFormSubmission"in c?c.cancelFormSubmission:a(G))("/"))},{default:o(()=>[s(" Cancel ")]),_:1}),n(i,{class:"primary-button",onClick:e[5]||(e[5]=t=>U())},{default:o(()=>[s(" Save ")]),_:1})])]),_:1})}}});export{se as default};
