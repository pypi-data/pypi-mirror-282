import{n as T,q as E,o as a,c as u,F as q,s as P,a as d,t as m,b as v,w as p,d as b,u as L,r as V,v as S,x as $,y as k,z as N,A as I,B as M,C as z}from"./entry.DufkozSH.js";import{u as j}from"./fetch.BKmV86es.js";import{r as H}from"./util.CdFxTbte.js";import{r as A,h as R}from"./http-error-handling.BbcmLHJS.js";const J={class:"table usa-table usa-table--borderless"},K=d("thead",null,[d("tr",null,[d("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Name"),d("th",{"data-sortable":"",scope:"col",role:"columnheader"},[b(" Permissions "),d("br"),b(" (Resource Type - Resource ID - Method) ")]),d("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Actions")])],-1),Q={class:"inline-input-left",style:{"max-width":"50ch"}},W={key:0},X={key:1},Y=T({__name:"group-list",props:{modelValue:{type:Array,required:!0,default:[]}},emits:["addGroup","editGroup","deleteGroup"],setup(h,{emit:G}){return(c,i)=>{const n=E("UsaButton");return a(),u("table",J,[K,(a(!0),u(q,null,P(h.modelValue,(_,f)=>(a(),u("tr",{key:f},[d("td",null,m(_.name),1),d("td",null,[(a(!0),u(q,null,P(_.permissions,(t,y)=>(a(),u("div",{key:y},[d("div",Q,[t.resource_id===null?(a(),u("span",W,m(t.resource_type)+" - (All) - "+m(t.method),1)):(a(),u("span",X,m(t.resource_type)+" - "+m(t.resource_id)+" - "+m(t.method),1))])]))),128))]),d("td",null,[v(n,{class:"secondary-button",onClick:t=>c.$emit("editGroup",_)},{default:p(()=>[b(" Edit ")]),_:2},1032,["onClick"]),v(n,{class:"usa-button usa-button--secondary",onClick:t=>c.$emit("deleteGroup",_.name)},{default:p(()=>[b(" Delete ")]),_:2},1032,["onClick"])])]))),128))])}}}),Z={key:0},O={class:"section-header"},ee={key:1},te=d("label",{class:"usa-label"},"Permissions",-1),oe={key:0},ae={key:1},re={class:"submit-footer"},se=T({__name:"group-edit",props:{modelValue:{type:Object,required:!0,default:{}},newGroupFlag:{type:Boolean,required:!0,default:!1}},emits:["cancel","submit","updateUserGroups"],async setup(h,{emit:G}){let c,i;const n=h,_=N(),f=L("token"),t=V({name:!1}),y=V([]),{data:C}=([c,i]=S(()=>j(_.public.apiPath+"/groups/permissions/details",{method:"GET",headers:{Authorization:"Bearer "+f.value}},"$MdsRazCG4z")),c=await c,i(),c);C.value&&C.value.forEach(r=>{y.value.push({resource_id:r.resource_id,resource_type:r.resource_type,method:r.method,selected:!1})}),y.value.forEach(r=>{n.modelValue.permissions.find(o=>o.resource_id===r.resource_id&&o.resource_type===r.resource_type&&o.method===r.method)&&(r.selected=!0)});function B(r,o){if(r)n.modelValue.permissions.push({resource_id:o.resource_id,resource_type:o.resource_type,method:o.method});else{const g=n.modelValue.permissions.find(e=>e.name===o.name&&e.resource_type===o.resource_type&&e.method===o.method),s=n.modelValue.permissions.indexOf(g);n.modelValue.permissions.splice(s,1)}}function U(){t.value=H(t.value);let r=!1;n.newGroupFlag&&n.modelValue.name.trim()===""&&(t.value.name=!0,r=!0),!r&&G("submit",n.modelValue)}return(r,o)=>{const g=E("UsaTextInput"),s=E("UsaCheckbox"),e=E("UsaButton");return a(),u("div",null,[h.newGroupFlag?$("",!0):(a(),u("div",Z,[d("h1",O,m(h.modelValue.name),1)])),h.newGroupFlag?(a(),u("div",ee,[v(g,{modelValue:h.modelValue.name,"onUpdate:modelValue":o[0]||(o[0]=l=>h.modelValue.name=l),error:k(t).name},{label:p(()=>[b(" Group Name ")]),"error-message":p(()=>[b(" Group name is required ")]),_:1},8,["modelValue","error"])])):$("",!0),te,(a(!0),u(q,null,P(k(y),(l,x)=>(a(),u("div",{key:x},[v(s,{modelValue:l.selected,"onUpdate:modelValue":[w=>l.selected=w,w=>B(l.selected,l)]},{default:p(()=>[l.resource_id===null?(a(),u("span",oe,m(l.resource_type)+" - (All) - "+m(l.method),1)):(a(),u("span",ae,m(l.resource_type)+" - "+m(l.resource_id)+" - "+m(l.method),1))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128)),d("div",re,[v(e,{class:"primary-button",onClick:o[1]||(o[1]=l=>r.$emit("cancel"))},{default:p(()=>[b(" Cancel ")]),_:1}),v(e,{class:"primary-button",onClick:U},{default:p(()=>[b(" Save ")]),_:1})])])}}}),ue={style:{"padding-top":"80px"}},ne={key:0},le={key:0},de={key:1},pe=T({__name:"group-management",setup(h){const G=N(),c=L("token"),i=V(!1),n=V(!1),_=V([]),f=V({});t();async function t(){await $fetch(G.public.apiPath+"/groups/details",{retry:0,method:"GET",headers:{Authorization:"Bearer "+c.value},onRequestError(){A()},onResponse({response:s}){_.value=s._data},onResponseError({response:s}){R(s.status,s._data.error_description)}})}function y(){f.value={name:"",permissions:[]}}function C(){y(),i.value=!0,n.value=!0}function B(s){f.value=s,i.value=!0,n.value=!1}async function U(s){confirm("Are you sure you want to delete the group: "+s+"?")&&await $fetch(G.public.apiPath+"/group/"+s,{retry:0,method:"DELETE",headers:{Authorization:"Bearer "+c.value},onRequestError(){A()},onResponse(){t()},onResponseError({response:e}){R(e.status,e._data.error_description)}})}function r(){i.value&&o()}function o(){confirm("Are you sure you want to cancel? All changes will be lost.")&&(i.value=!1,y())}async function g(s){try{n.value?await $fetch(G.public.apiPath+"/group",{retry:0,method:"POST",headers:{Authorization:"Bearer "+c.value},body:s,onRequestError(){A()},onResponse(){t()},onResponseError({response:e}){R(e.status,e._data.error_description)}}):await $fetch(G.public.apiPath+"/group",{retry:0,method:"PUT",body:s,headers:{Authorization:"Bearer "+c.value},onRequestError(){A()},onResponse(){t()},onResponseError({response:e}){R(e.status,e._data.error_description)}})}catch{return}y(),i.value=!1}return(s,e)=>{const l=E("UsaButton"),x=Y,w=se,D=M;return a(),I(D,{name:"base-layout",onManageGroups:r},{sidebar:p(()=>[d("div",ue,[k(i)?$("",!0):(a(),u("div",ne,[v(l,{class:"secondary-button margin-button",onClick:C},{default:p(()=>[b(" Add Group ")]),_:1})]))])]),default:p(()=>[k(i)?$("",!0):(a(),u("div",le,[v(x,{modelValue:k(_),"onUpdate:modelValue":e[0]||(e[0]=F=>z(_)?_.value=F:null),onEditGroup:B,onDeleteGroup:U},null,8,["modelValue"])])),k(i)?(a(),u("div",de,[v(w,{modelValue:k(f),"onUpdate:modelValue":e[1]||(e[1]=F=>z(f)?f.value=F:null),"new-group-flag":k(n),onCancel:o,onSubmit:g},null,8,["modelValue","new-group-flag"])])):$("",!0)]),_:1})}}});export{pe as default};
