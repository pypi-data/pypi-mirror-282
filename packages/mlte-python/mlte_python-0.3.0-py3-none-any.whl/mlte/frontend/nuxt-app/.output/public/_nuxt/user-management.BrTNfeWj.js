import{n as T,q as k,o as m,c as f,a as n,F as G,s as j,t as q,b as u,w as r,d as t,u as L,r as y,v as H,y as d,x as w,C as S,z as I,A as K,B as M}from"./entry.DufkozSH.js";import{u as J}from"./fetch.BKmV86es.js";import{r as Q}from"./util.CdFxTbte.js";import{r as A,h as F}from"./http-error-handling.BbcmLHJS.js";const W={class:"table usa-table usa-table--borderless"},X=n("thead",null,[n("tr",null,[n("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Username"),n("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Email"),n("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Full Name"),n("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Disabled"),n("th",{scope:"col",role:"columnheader"},"Actions")])],-1),Y={class:"centered-container",style:{"margin-bottom":"1.5em"}},Z=T({__name:"user-list",props:{modelValue:{type:Array,required:!0,default:[]}},emits:["addUser","editUser","deleteUser"],setup(s,{emit:g}){return(v,$)=>{const l=k("UsaCheckbox"),h=k("UsaButton");return m(),f("table",W,[X,n("tbody",null,[(m(!0),f(G,null,j(s.modelValue,(p,V)=>(m(),f("tr",{key:V},[n("td",null,q(p.username),1),n("td",null,q(p.email),1),n("td",null,q(p.full_name),1),n("td",null,[n("div",Y,[u(l,{modelValue:p.disabled,"onUpdate:modelValue":b=>p.disabled=b,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])]),n("td",null,[u(h,{class:"secondary-button",onClick:b=>v.$emit("editUser",p)},{default:r(()=>[t(" Edit ")]),_:2},1032,["onClick"]),u(h,{class:"usa-button usa-button--secondary",onClick:b=>v.$emit("deleteUser",p.username)},{default:r(()=>[t(" Delete ")]),_:2},1032,["onClick"])])]))),128))])])}}}),O={key:0},ee={class:"flex-container"},ae={class:"section-header"},le={class:"centered-container",style:{"vertical-align":"bottom","padding-left":"38ch"}},oe={key:0},se={key:1},te={key:0},re={key:1},ne=n("label",{class:"usa-label"},"Groups",-1),ue={key:2},de=n("b",null,"create-model",-1),ie={class:"submit-footer"},me=T({__name:"user-edit",props:{modelValue:{type:Object,required:!0,default:{username:"",password:"",email:"",full_name:"",disabled:!1,role:"regular",groups:[]}},newUserFlag:{type:Boolean,required:!0,default:!1}},emits:["cancel","submit","updateUserGroups"],async setup(s,{emit:g}){let v,$;const l=s,h=I(),p=L("token"),V=y(!1),b=y(""),C=y([{value:"admin",text:"admin"},{value:"regular",text:"regular"}]),c=y({username:!1,role:!1,password:!1,confirmPassword:!1}),P=y([]),{data:B}=([v,$]=H(()=>J(h.public.apiPath+"/groups/details",{retry:0,method:"GET",headers:{Authorization:"Bearer "+p.value}},"$CRreKmBvzB")),v=await v,$(),v);B.value&&B.value.forEach(e=>{P.value.push({name:e.name,permissions:e.permissions,selected:!1})}),P.value.forEach(e=>{l.modelValue.groups.find(a=>a.name===e.name)&&(e.selected=!0)}),l.newUserFlag&&(l.modelValue.role="regular");function N(){V.value=!0,l.modelValue.password=""}function R(){V.value=!1,delete l.modelValue.password}function z(e,a){if(e)l.modelValue.groups.push({name:a.name,permissions:a.permissions});else{const _=l.modelValue.groups.find(E=>E.name===a.name),U=l.modelValue.groups.indexOf(_);l.modelValue.groups.splice(U,1)}}async function i(){c.value=Q(c.value);let e=!1;l.newUserFlag&&(l.modelValue.username.trim()===""&&(c.value.username=!0,e=!0),l.modelValue.password.trim()===""&&(c.value.password=!0,e=!0)),V.value&&(l.modelValue.password.trim()===""&&(c.value.password=!0,e=!0),l.modelValue.password!==b.value&&(c.value.confirmPassword=!0,e=!0)),l.modelValue.role.trim()===""&&(c.value.role=!0,e=!0),!e&&g("submit",l.modelValue)}return(e,a)=>{const _=k("UsaButton"),U=k("UsaTextInput"),E=k("UsaCheckbox"),x=k("UsaSelect");return m(),f("div",null,[s.newUserFlag?w("",!0):(m(),f("div",O,[n("div",ee,[n("h1",ae,q(s.modelValue.username),1),n("div",le,[d(V)?w("",!0):(m(),f("div",oe,[u(_,{class:"secondary-button",onClick:N},{default:r(()=>[t(" Change Password ")]),_:1})])),d(V)?(m(),f("div",se,[u(_,{class:"secondary-button",onClick:R},{default:r(()=>[t(" Cancel Change ")]),_:1})])):w("",!0)])]),d(V)?(m(),f("div",te,[u(U,{modelValue:s.modelValue.password,"onUpdate:modelValue":a[0]||(a[0]=o=>s.modelValue.password=o),error:d(c).password,type:"password"},{label:r(()=>[t(" New Password ")]),"error-message":r(()=>[t(" Password is required ")]),_:1},8,["modelValue","error"]),u(U,{modelValue:d(b),"onUpdate:modelValue":a[1]||(a[1]=o=>S(b)?b.value=o:null),error:d(c).confirmPassword,type:"password"},{label:r(()=>[t(" Confirm New Password ")]),"error-message":r(()=>[t(" Passwords to not match ")]),_:1},8,["modelValue","error"])])):w("",!0)])),s.newUserFlag?(m(),f("div",re,[u(U,{modelValue:s.modelValue.username,"onUpdate:modelValue":a[2]||(a[2]=o=>s.modelValue.username=o),error:d(c).username},{label:r(()=>[t(" Username ")]),"error-message":r(()=>[t(" Username is required ")]),_:1},8,["modelValue","error"]),u(U,{modelValue:s.modelValue.password,"onUpdate:modelValue":a[3]||(a[3]=o=>s.modelValue.password=o),error:d(c).password,type:"password"},{label:r(()=>[t(" Password ")]),"error-message":r(()=>[t(" Password is required ")]),_:1},8,["modelValue","error"])])):w("",!0),u(U,{modelValue:s.modelValue.email,"onUpdate:modelValue":a[4]||(a[4]=o=>s.modelValue.email=o)},{label:r(()=>[t(" Email ")]),_:1},8,["modelValue"]),u(U,{modelValue:s.modelValue.full_name,"onUpdate:modelValue":a[5]||(a[5]=o=>s.modelValue.full_name=o)},{label:r(()=>[t(" Full Name ")]),_:1},8,["modelValue"]),u(E,{modelValue:s.modelValue.disabled,"onUpdate:modelValue":a[6]||(a[6]=o=>s.modelValue.disabled=o),label:"Disabled"},null,8,["modelValue"]),u(x,{modelValue:s.modelValue.role,"onUpdate:modelValue":a[7]||(a[7]=o=>s.modelValue.role=o),options:d(C),error:d(c).role,onChange:a[8]||(a[8]=o=>d(c).role=!1)},{label:r(()=>[t(" Role ")]),"error-message":r(()=>[t(" A role must be selected ")]),_:1},8,["modelValue","options","error"]),ne,s.newUserFlag?(m(),f("div",ue,[t(" User will automatically be added to the "),de,t(" group upon submission. ")])):w("",!0),(m(!0),f(G,null,j(d(P),o=>(m(),f("div",{key:o.name},[u(E,{modelValue:o.selected,"onUpdate:modelValue":[D=>o.selected=D,D=>z(o.selected,o)],label:o.name},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),n("div",ie,[u(_,{class:"primary-button",onClick:a[9]||(a[9]=o=>e.$emit("cancel"))},{default:r(()=>[t(" Cancel ")]),_:1}),u(_,{class:"primary-button",onClick:i},{default:r(()=>[t(" Save ")]),_:1})])])}}}),ce={style:{"padding-top":"80px"}},fe={key:0},pe={key:0},Ve={key:1},we=T({__name:"user-management",setup(s){const g=I(),v=L("token"),$=L("user"),l=y(!1),h=y(!1),p=y([]),V=y({});b(),C();async function b(){await $fetch(g.public.apiPath+"/users/details",{retry:0,method:"GET",headers:{Authorization:"Bearer "+v.value},onRequestError(){A()},onResponse({response:i}){p.value=i._data},onResponseError({response:i}){F(i.status,i._data.error_description)}})}function C(){V.value={username:"",email:"",full_name:"",disabled:!1,role:"",groups:[],password:""}}function c(){C(),l.value=!0,h.value=!0}function P(i){V.value=i,l.value=!0,h.value=!1}async function B(i){if($.value===i){alert("Cannot delete the active user.");return}confirm("Are you sure you want to delete user, "+i+"?")&&await $fetch(g.public.apiPath+"/user/"+i,{retry:0,method:"DELETE",headers:{Authorization:"Bearer "+v.value},onRequestError(){A()},onResponse(){b()},onResponseError({response:e}){F(e.status,e._data.error_description)}})}function N(){l.value&&R()}function R(){confirm("Are you sure you want to cancel? All changes will be lost.")&&(l.value=!1,C())}async function z(i){try{h.value?await $fetch(g.public.apiPath+"/user",{retry:0,method:"POST",headers:{Authorization:"Bearer "+v.value},body:i,onRequestError(){A()},onResponse(){b()},onResponseError({response:e}){F(e.status,e._data.error_description)}}):await $fetch(g.public.apiPath+"/user",{retry:0,method:"PUT",body:i,headers:{Authorization:"Bearer "+v.value},onRequestError(){A()},onResponse(){b()},onResponseError({response:e}){F(e.status,e._data.error_description)}})}catch{return}C(),l.value=!1}return(i,e)=>{const a=k("UsaButton"),_=Z,U=me,E=M;return m(),K(E,{name:"base-layout",onManageUsers:N},{sidebar:r(()=>[n("div",ce,[d(l)?w("",!0):(m(),f("div",fe,[u(a,{class:"secondary-button",onClick:c},{default:r(()=>[t(" Add User ")]),_:1})]))])]),default:r(()=>[d(l)?w("",!0):(m(),f("div",pe,[u(_,{modelValue:d(p),"onUpdate:modelValue":e[0]||(e[0]=x=>S(p)?p.value=x:null),onEditUser:P,onDeleteUser:B},null,8,["modelValue"])])),d(l)?(m(),f("div",Ve,[u(U,{modelValue:d(V),"onUpdate:modelValue":e[1]||(e[1]=x=>S(V)?V.value=x:null),"new-user-flag":d(h),onCancel:R,onSubmit:z},null,8,["modelValue","new-user-flag"])])):w("",!0)]),_:1})}}});export{we as default};
