import{p as l,S as m,i as u,s as g,v as p,w as f,x as h,m as _,k as I,y}from"../chunks/Component.XCUzfIB4.mjs";import{u as $,a as b}from"../chunks/backend.WLkVIN8Y.mjs";import{q as O,r as v,t as T}from"../chunks/ftl.kZuA-e76.mjs";import{e as k,n as w,t as P,T as C,h as x,I as N}from"../chunks/ImageOcclusionPage.aogPLgGk.mjs";import"../chunks/index.HrFqG6o2.mjs";const S=async function(a,e){const{clozes:s,noteCount:t}=k(e);if(t===0)return;const o=l(w),i=l(P);let n=o[0].textareaValue,r=o[1].textareaValue;if(n=n?`<div>${n}</div>`:"",r=n?`<div>${r}</div>`:"",a.kind=="edit"){const c=await $({noteId:BigInt(a.noteId),occlusions:s,header:n,backExtra:r,tags:i});d(a.noteId,c,t)}else{const c=await b({notetypeId:BigInt(a.notetypeId),imagePath:a.imagePath,occlusions:s,header:n,backExtra:r,tags:i});d(null,c,t)}},d=(a,e,s)=>{const t=new C({target:document.body,props:{message:"",type:"error"}});if(e.note){const o=a?O({count:s}):v({count:s});t.$set({message:o,type:"success",showToast:!0})}else{const o=T();t.$set({message:o,showToast:!0})}};async function z(){S(globalThis.anki.imageOcclusion.mode,l(x))}const D=async({params:a})=>{let e;return/^\d+/.test(a.imagePathOrNoteId)?e={kind:"edit",noteId:Number(a.imagePathOrNoteId)}:e={kind:"add",imagePath:a.imagePathOrNoteId,notetypeId:0},globalThis.anki=globalThis.anki||{},globalThis.anki.imageOcclusion={mode:e,save:z},{mode:e}},V=Object.freeze(Object.defineProperty({__proto__:null,load:D},Symbol.toStringTag,{value:"Module"}));function j(a){let e,s;return e=new N({props:{mode:a[0].mode}}),{c(){p(e.$$.fragment)},l(t){f(e.$$.fragment,t)},m(t,o){h(e,t,o),s=!0},p(t,[o]){const i={};o&1&&(i.mode=t[0].mode),e.$set(i)},i(t){s||(_(e.$$.fragment,t),s=!0)},o(t){I(e.$$.fragment,t),s=!1},d(t){y(e,t)}}}function q(a,e,s){let{data:t}=e;return a.$$set=o=>{"data"in o&&s(0,t=o.data)},[t]}class M extends m{constructor(e){super(),u(this,e,q,j,g,{data:0})}}export{M as component,V as universal};
