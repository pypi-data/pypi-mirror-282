import{r as p,j as e,aw as L,I as C,ax as K,u as T,ay as w,az as ce,aA as ie,aB as de,h as g,y as I,S as R,f as _,av as ue,aj as me,aC as pe,aD as fe}from"./index-DrGRDGb9.js";import{u as W,a as he,F as xe}from"./form-BSHLfECY.js";import{P as ge}from"./index-CWNB6SHN.js";import{C as je,S as G,I as we}from"./index-CgchWYCJ.js";import{D as ve}from"./index-c94F32Le.js";import{N as Se}from"./index-HObLf9jX.js";import{C as De}from"./checkbox-CZPICiDd.js";import{c as Ce}from"./cloneDeep-QtHVaN1A.js";import"./label-BaCmcWHY.js";import"./table-DcNzPC6S.js";import"./index-BeOGRdMv.js";import"./index-CQP_Djvk.js";import"./index-sRjElhp3.js";import"./separator-DcpduVGU.js";import"./index-aEMzJK_0.js";import"./input-OS170_Fj.js";import"./index-EkT8jcT8.js";import"./popover-B42lDIGl.js";import"./index-B7fXPLLo.js";function be({onFileDrop:t,children:l,dragMessage:a}){const[c,o]=p.useState(!1);p.useEffect(()=>{const d=()=>{document.visibilityState==="visible"&&o(!1)};return document.addEventListener("visibilitychange",d),()=>{document.removeEventListener("visibilitychange",d)}},[]);const n=d=>{d.preventDefault(),d.dataTransfer.types.some(m=>m==="Files")&&t&&o(!0)},s=d=>{d.dataTransfer.types.some(m=>m==="Files")&&t&&o(!0),d.preventDefault()},i=d=>{d.preventDefault(),t&&o(!1)},u=d=>{d.preventDefault(),t&&t(d),o(!1)};return e.jsx("div",{onDragOver:n,onDragEnter:s,onDragLeave:i,onDrop:u,className:L("h-full w-full",c?"mb-36 flex flex-col items-center justify-center gap-4 text-2xl font-light":""),children:c?e.jsxs(e.Fragment,{children:[e.jsx(C,{name:"ArrowUpToLine",className:"h-12 w-12 stroke-1"}),a||"Drop your file here"]}):l})}const ye=(t,l)=>{var d;const a=K(),c=T(m=>m.setSuccessData),o=T(m=>m.setErrorData),n=w(m=>m.getFolderById),s=(d=a==null?void 0:a.state)==null?void 0:d.folderId,i=w(m=>m.myCollectionId);return[m=>{if(m.preventDefault(),m.dataTransfer.types.some(f=>f==="Files")){const f=m.dataTransfer.files.item(0);if(f.type==="application/json"){const j=new FileReader;j.onload=h=>{const S=h.target.result,y=JSON.parse(S).is_component;t({newProject:!0,file:f,isComponent:l==="all"?null:l==="component"}).then(()=>{c({title:`${y?"Component":"Flow"} uploaded successfully`}),n(s||i)}).catch(N=>{o({title:ce,list:[N]})})},j.readAsText(f)}else o({title:ie,list:[de]})}}]},Ne=t=>{switch(t){case"all":return"Component or Flow";case"component":return"Component";default:return"Flow"}},Ee=(t,l)=>{const a=l==="component",c=(n,s)=>{const i=(n==null?void 0:n.updated_at)||(n==null?void 0:n.date_created),u=(s==null?void 0:s.updated_at)||(s==null?void 0:s.date_created);return i&&u?new Date(u).getTime()-new Date(i).getTime():i?1:u?-1:0},o=l==="all"?t:t==null?void 0:t.filter(n=>((n==null?void 0:n.is_component)??!1)===a);return(o==null?void 0:o.sort(c))??[]},ke=({})=>{g(a=>a.addFlow),I();const[t,l]=p.useState(!1);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-2 flex w-full items-center justify-center text-center",children:e.jsx("div",{className:"flex-max-width h-full flex-col",children:e.jsxs("div",{className:"align-center flex w-full justify-center gap-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"This folder is empty. New?"}),e.jsxs("span",{className:"transition-colors hover:text-muted-foreground",children:[e.jsx(Se,{open:t,setOpen:l}),e.jsx("button",{onClick:()=>{l(!0)},className:"underline",children:"Start Here"})]}),e.jsx("span",{className:"animate-pulse",children:"ðŸš€"})]})})})})},Le=({handleSelectAll:t,handleDelete:l,handleDuplicate:a,handleExport:c,disableFunctions:o})=>{const[n,s]=p.useState(!0),i=()=>{t(n),s(u=>!u)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center justify-self-start",children:e.jsx("a",{onClick:i,className:"cursor-pointer text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(De,{checked:!n,id:"terms"}),e.jsx("span",{className:"label text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:n?"Select All":"Unselect All"})]})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:e.jsx(R,{content:o?e.jsx("span",{children:"Select items to export"}):e.jsx("span",{children:"Export selected items"}),children:e.jsx(_,{unstyled:!0,onClick:c,disabled:o,children:e.jsx(C,{name:"FileDown",className:L("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(R,{content:o?e.jsx("span",{children:"Select items to duplicate"}):e.jsx("span",{children:"Duplicate selected items"}),children:e.jsx(_,{unstyled:!0,onClick:a,disabled:o,children:e.jsx(C,{name:"Copy",className:L("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(R,{content:o?e.jsx("span",{children:"Select items to delete"}):e.jsx("span",{children:"Delete selected items"}),children:e.jsx(_,{unstyled:!0,onClick:l,disabled:o,children:e.jsx(C,{name:"Trash2",className:L("h-5 w-5 text-primary transition-all",o?"":"hover:text-status-red")})})})})]})]})})},_e=({item:t,type:l,isLoading:a,control:c})=>{const o=I(),n=t.is_component??!1,s=`/flow/${t.id}`,i=`edit-flow-button-${t.id}`,u=()=>{n||o(s)},d=()=>n?null:e.jsx(ue,{to:s,children:e.jsxs(_,{tabIndex:-1,variant:"outline",size:"sm",className:"whitespace-nowrap","data-testid":i,children:[e.jsx(C,{name:"ExternalLink",className:"main-page-nav-button select-none"}),"Edit Flow"]})});return e.jsx(je,{is_component:l==="component",data:{is_component:n,...t},disabled:a,"data-testid":i,button:d(),onClick:n?void 0:u,playground:!n,control:c})},Te=(t,l,a,c,o,n,s,i,u)=>({handleDeleteMultiple:p.useCallback(()=>{l(t).then(()=>{a(),c(!0),(!o||o===n)&&s(o||n),i({title:"Selected items deleted successfully"})}).catch(()=>{u({title:"Error deleting items",list:["Please try again"]})})},[t,l,a,c,o,n,s,i,u])}),Oe=(t,l)=>p.useMemo(()=>{const c=n=>({all:"item",component:"component",flow:"flow"})[n]||"",o=n=>({all:"items",component:"components",flow:"flows"})[n]||"";return(t==null?void 0:t.length)===1?c(l):o(l)},[t,l]),Ae=(t,l,a)=>{p.useEffect(()=>{const o=Ce(t||[]).filter(n=>n.name.toLowerCase().includes(l.toLowerCase())||n.description.toLowerCase().includes(l.toLowerCase()));a(l===""?t:o)},[t,l,a])},Me=(t,l,a,c,o,n,s,i,u,d,m,f)=>({handleDuplicate:p.useCallback(()=>{Promise.all(t.map(h=>l(!0,a.find(S=>S.id===h)))).then(()=>{c(),o(!0),(!n||n===s)&&i(n||s),u({title:`${f} duplicated successfully`}),d([]),m(!1)})},[t,l,a,c,o,n,s,i,u,d,m,f])}),Fe=(t,l,a,c,o,n,s,i,u)=>({handleExport:p.useCallback(()=>{t.forEach(m=>{const f=l.find(j=>j.id===m);f&&a(c({id:f.id,data:f.data,description:f.description,name:f.name,last_tested_version:o,endpoint_name:f.endpoint_name,is_component:!1}),f.name,f.description)}),n({title:`${u} exported successfully`}),s([]),i(!1)},[t,l,a,c,o,n,s,i,u])}),Re=(t,l,a)=>({handleSelectAll:p.useCallback(o=>{const n=t==null?void 0:t.map(s=>s.id);if(o){Object.keys(l()).forEach(s=>{n!=null&&n.includes(s)&&a(s,!0)});return}Object.keys(l()).forEach(s=>{a(s,!1)})},[t,l,a])}),Ie=(t,l,a,c,o)=>({handleSelectOptionsChange:p.useCallback(s=>{if(!((t==null?void 0:t.length)>0)){l({title:"No items selected",list:["Please select items to delete"]});return}s==="delete"?a(!0):s==="duplicate"?c():s==="export"&&o()},[t,l,a,c,o])}),Pe=(t,l)=>{p.useEffect(()=>{if(!t||Object.keys(t).length===0)return;const a=Object.keys(t).filter(c=>t[c]===!0);l(a)},[t,l])};function Be({type:t="all"}){var J;const l=g(r=>r.uploadFlow),a=g(r=>r.removeFlow),c=g(r=>r.isLoading),o=g(r=>r.setAllFlows),n=g(r=>r.allFlows),s=w(r=>{var v;return(v=r.selectedFolder)==null?void 0:v.flows}),i=T(r=>r.setSuccessData),u=T(r=>r.setErrorData),[d,m]=p.useState(!1),f=g(r=>r.searchFlowsComponents),j=g(r=>r.setSelectedFlowsComponentsCards),h=g(r=>r.selectedFlowsComponentsCards),[S]=ye(l,t),[b,y]=p.useState(20),[N,P]=p.useState(1),E=K(),O=Ee(n,t),B=(N-1)*b,q=B+b,x=O==null?void 0:O.slice(B,q),Q=Ne(t),D=(J=E==null?void 0:E.state)==null?void 0:J.folderId,A=w(r=>r.getFolderById),M=w(r=>r.myCollectionId),U=w(r=>r.getFoldersApi),X=w(r=>r.setFolderUrl),Y=g(r=>r.addFlow),$=p.useMemo(()=>window.location.pathname.includes("components")?"Components":window.location.pathname.includes("flows")?"Flows":"Items",[window.location]);p.useEffect(()=>{X(D??""),j([]),k(!1),A(D||M)},[E]),Ae(s,f,o);const z=()=>{P(1),y(20)},{getValues:Z,control:H,setValue:V}=W(),ee=he({control:H}),te=W(),{handleSelectAll:k}=Re(s,Z,V),{handleDuplicate:ne}=Me(h,Y,n,z,U,D,M,A,i,j,k,$),se=me(r=>r.version),{handleExport:le}=Fe(h,n,fe,pe,se,i,j,k,$),{handleSelectOptionsChange:F}=Ie(h,u,m,ne,le),{handleDeleteMultiple:oe}=Te(h,a,z,U,D,M,A,i,u);Pe(ee,j);const ae=Oe(h,t),re=()=>{var r;return t==="all"?n==null?void 0:n.length:(r=n==null?void 0:n.filter(v=>(v.is_component??!1)===(t==="component")))==null?void 0:r.length};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full gap-4 pb-5",children:(n==null?void 0:n.length)>0&&e.jsx(Le,{handleDelete:()=>F("delete"),handleSelectAll:k,handleDuplicate:()=>F("duplicate"),handleExport:()=>F("export"),disableFunctions:!((h==null?void 0:h.length)>0)})}),e.jsx(be,{onFileDrop:S,dragMessage:`Drag your ${Q} here`,children:e.jsxs("div",{className:"flex h-full w-full flex-col justify-between",children:[e.jsx("div",{className:"flex w-full flex-col gap-4",children:!c&&(x==null?void 0:x.length)===0?e.jsx(ke,{}):e.jsx("div",{className:"grid w-full gap-4 md:grid-cols-2 lg:grid-cols-2",children:c===!1&&(x==null?void 0:x.length)>0?e.jsx(e.Fragment,{children:x==null?void 0:x.map(r=>p.createElement(xe,{...te,key:r.id},e.jsx("form",{children:e.jsx(_e,{item:r,type:t,isLoading:c,control:H})})))}):e.jsxs(e.Fragment,{children:[e.jsx(G,{}),e.jsx(G,{})]})})}),!c&&(x==null?void 0:x.length)>0&&e.jsx("div",{className:"relative py-6",children:e.jsx(ge,{storeComponent:!0,pageIndex:N,pageSize:b,rowsCount:[10,20,50,100],totalRowsCount:re(),paginate:(r,v)=>{P(v),y(r)}})})]})}),d&&e.jsx(ve,{open:d,setOpen:m,onConfirm:oe,description:ae,children:e.jsx(e.Fragment,{})})]})}const Ue=({tabsOptions:t,setActiveTab:l,loading:a,tabActive:c})=>{const o=I(),n=w(i=>i.folderUrl),s=i=>{const u=window.location.pathname;let d="";switch(i){case"Flows":d=u.replace(/components|all/,"flows");break;case"Components":d=u.replace(/flows|all/,"components");break;default:d=u.replace(/flows|components/,"all");break}o(d,{state:{folderId:n}})};return p.useEffect(()=>{const i=window.location.pathname;i.includes("components")?l("Components"):i.includes("flows")?l("Flows"):l("All")},[window.location.pathname]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"ml-4 flex w-full gap-2 border-b border-border",children:t.map((i,u)=>e.jsx("button",{"data-testid":`${i}-button-store`,disabled:a,onClick:()=>{s(i)},className:(c===i?"border-b-2 border-primary p-3":"border-b-2 border-transparent p-3 text-muted-foreground hover:text-primary")+(a?" cursor-not-allowed":""),children:i},u))})})},$e=({})=>{const t=g(s=>s.isLoading),[l,a]=p.useState("Flows"),[c,o]=p.useState(""),n=g(s=>s.setSearchFlowsComponents);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative flex items-end gap-4",children:[e.jsx(we,{loading:t,value:c,onChange:s=>{n(s.target.value),o(s.target.value)},onKeyDown:s=>{s.key==="Enter"&&n(c)}}),e.jsx(Ue,{tabsOptions:["All","Flows","Components"],setActiveTab:a,loading:t,tabActive:l})]})})},rt=({type:t})=>e.jsxs(e.Fragment,{children:[e.jsx($e,{}),e.jsx("div",{className:"mt-5 flex h-full flex-col",children:e.jsx(Be,{type:t},t)})]});export{rt as default};
