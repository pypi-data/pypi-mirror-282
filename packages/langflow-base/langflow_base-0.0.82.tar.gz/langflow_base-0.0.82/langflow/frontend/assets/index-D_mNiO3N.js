import{a_ as z,a$ as J,b0 as Q,b1 as k,b2 as L,p as X,r as h,A as y,b3 as Z,b4 as ee,b5 as se,j as e,I as ae,$ as A,aM as E,b6 as v,aP as N,aO as _,aN as R,a as b,d as S,b7 as I,g as $,f as j,b8 as F,aj as te,b9 as re,aw as ne,ba as K,bb as le,bc as oe,bd as ce,be as ie,bf as de,bg as ue,bh as he,h as me,au as fe,bi as xe,u as T,af as f}from"./index-DrGRDGb9.js";import{c as pe}from"./cloneDeep-QtHVaN1A.js";import{I as C}from"./index-B7fXPLLo.js";import"./input-OS170_Fj.js";import"./popover-B42lDIGl.js";const Pe=(t,n,a)=>({handlePatchPassword:async(s,o,c)=>{var d,r;if(s!==o){a({title:z,list:[J]});return}try{s!==""&&await Q(t.id,{password:s}),c({target:{name:"password",value:""}}),c({target:{name:"cnfPassword",value:""}}),n({title:k})}catch(u){a({title:L,list:[(r=(d=u==null?void 0:u.response)==null?void 0:d.data)==null?void 0:r.detail]})}}}),ge=Pe,je=(t,n,a,l)=>({currentUserData:a,handlePatchProfilePicture:async o=>{var c,d;try{if(o!==""){await X(a.id,{profile_image:o});let r=pe(a);r.profile_image=o,l(r)}t({title:k})}catch(r){n({title:L,list:[(d=(c=r==null?void 0:r.response)==null?void 0:c.data)==null?void 0:d.detail]})}}}),we=je,ye=(t,n,a,l,s)=>{const{storeApiKey:o}=h.useContext(y);return{handleSaveKey:(d,r)=>{d&&(s(!0),Z(d).then(()=>{t({title:ee}),o(d),a(!0),l(!0),s(!1),r({target:{name:"apikey",value:""}})},u=>{n({title:se,list:[u.response.data.detail]}),a(!1),l(!1),s(!1)}))}}},be=ye,Se=(t,n)=>{h.useEffect(()=>{const a=document.getElementById(t??"null");a&&a.scrollIntoView({behavior:"smooth"})},[t]),h.useEffect(()=>{n("")},[n])},Ce=Se,Ae=()=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-4 space-y-0.5",children:e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("h2",{className:"flex items-center text-lg font-semibold tracking-tight",children:["General",e.jsx(ae,{name:"SlidersHorizontal",className:"ml-2 h-5 w-5 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage settings related to Langflow and your account."})]})})}),Ee=Ae,ve=({password:t,cnfPassword:n,handleInput:a,handlePatchPassword:l})=>e.jsx(e.Fragment,{children:e.jsx(A,{onSubmit:s=>{l(t,n,a),s.preventDefault()},children:e.jsxs(E,{"x-chunk":"dashboard-04-chunk-2",children:[e.jsxs(v,{children:[e.jsx(N,{children:"Password"}),e.jsx(_,{children:"Type your new password and confirm it."})]}),e.jsx(R,{children:e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsxs(b,{name:"password",className:"w-full",children:[e.jsx(C,{id:"pasword",onChange:s=>{a({target:{name:"password",value:s}})},value:t,isForm:!0,password:!0,placeholder:"Password",className:"w-full"}),e.jsx(S,{match:"valueMissing",className:"field-invalid",children:"Please enter your password"})]}),e.jsxs(b,{name:"cnfPassword",className:"w-full",children:[e.jsx(C,{id:"cnfPassword",onChange:s=>{a({target:{name:"cnfPassword",value:s}})},value:n,isForm:!0,password:!0,placeholder:"Confirm Password",className:"w-full"}),e.jsx(S,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})]})}),e.jsx(I,{className:"border-t px-6 py-4",children:e.jsx($,{asChild:!0,children:e.jsx(j,{type:"submit",children:"Save"})})})]})})}),Ne=ve,_e=(t,n)=>{const a=async l=>Promise.all(l.map(s=>new Promise(o=>{const c=new Image;c.src=s,c.onload=o,c.onerror=o})));h.useEffect(()=>{const l=[];Object.keys(t).flatMap(s=>t[s].map(o=>l.push(`${F}files/profile_pictures/${s}/${o}`))),a(l).then(()=>{n(!0)})},[t])};function Re({profilePictures:t,loading:n,value:a,onChange:l}){const s=h.useRef(null),o=te(r=>r.dark),[c,d]=h.useState(!1);return h.useEffect(()=>{var r;a&&s&&((r=s.current)==null||r.scrollIntoView({behavior:"smooth",block:"center"}))},[s,a]),_e(t,d),e.jsx("div",{className:"flex flex-col justify-center gap-2",children:n||!c?e.jsx(re,{}):Object.keys(t).map((r,u)=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"edit-flow-arrangement",children:e.jsx("span",{className:"font-normal",children:r})}),e.jsx("div",{className:"block overflow-hidden",children:e.jsx("div",{className:"flex items-center gap-1 overflow-x-auto rounded-lg bg-muted px-1 custom-scroll",children:t[r].map((m,p)=>e.jsx(j,{ref:a===r+"/"+m?s:void 0,unstyled:!0,onClick:()=>l(r+"/"+m),className:"shrink-0 px-0.5 py-2",children:e.jsx("img",{src:`${F}files/profile_pictures/${r+"/"+m}`,style:{filter:a===r+"/"+m?o?"drop-shadow(0 0 0.3rem rgb(255, 255, 255))":"drop-shadow(0 0 0.3rem rgb(0, 0, 0))":""},className:ne("h-12 w-12")},p)}))})})]}))})}const Ie=({profilePicture:t,handleInput:n,handlePatchProfilePicture:a,handleGetProfilePictures:l,userData:s})=>{const[o,c]=h.useState({}),[d,r]=h.useState(!0);return h.useEffect(()=>{const u=new AbortController;return l().then(m=>{m&&m.forEach(p=>{const[P,g]=p.split("/");c(x=>(x[P]?x[P].push(g):x[P]=[g],r(!1),x))})}).catch(()=>{r(!1)}),()=>u.abort()},[]),e.jsx(A,{onSubmit:u=>{a(t),u.preventDefault()},children:e.jsxs(E,{"x-chunk":"dashboard-04-chunk-1",children:[e.jsxs(v,{children:[e.jsx(N,{children:"Profile Picture"}),e.jsx(_,{children:"Choose the image that appears as your profile picture."})]}),e.jsx(R,{children:e.jsx("div",{className:"py-2",children:e.jsx(Re,{profilePictures:o,loading:d,value:t==""?(s==null?void 0:s.profile_image)??K[parseInt((s==null?void 0:s.id)??"",30)%K.length]:t,onChange:u=>{n({target:{name:"profilePicture",value:u}})}})})}),e.jsx(I,{className:"border-t px-6 py-4",children:e.jsx($,{asChild:!0,children:e.jsx(j,{type:"submit",children:"Save"})})})]})})},$e=Ie,Ke=t=>({handleGetProfilePictures:async()=>{var a,l;try{return(await le()).files}catch(s){oe.isCancel(s)?console.warn("Request canceled: ",s.message):t({title:ce,list:[(l=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:l.detail]})}}}),Te=Ke,ke=({apikey:t,handleInput:n,handleSaveKey:a,loadingApiKey:l,validApiKey:s,hasApiKey:o})=>e.jsx(e.Fragment,{children:e.jsx(A,{onSubmit:c=>{c.preventDefault(),a(t,n)},children:e.jsxs(E,{"x-chunk":"dashboard-04-chunk-2",id:"api",children:[e.jsxs(v,{children:[e.jsx(N,{children:"Store API Key"}),e.jsx(_,{children:(o&&!s?ie:o?"":de)+ue})]}),e.jsx(R,{children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsx("div",{className:"flex w-full gap-4",children:e.jsxs(b,{name:"apikey",className:"w-full",children:[e.jsx(C,{id:"apikey",onChange:c=>{n({target:{name:"apikey",value:c}})},value:t,isForm:!0,password:!0,placeholder:"Insert your API Key",className:"w-full"}),e.jsx(S,{match:"valueMissing",className:"field-invalid",children:"Please enter your API Key"})]})}),e.jsxs("span",{className:"pr-1 text-xs text-muted-foreground",children:[he," ",e.jsx("a",{className:"text-high-indigo underline",href:"https://langflow.store/",target:"_blank",children:"langflow.store"})]})]})}),e.jsx(I,{className:"border-t px-6 py-4",children:e.jsx($,{asChild:!0,children:e.jsx(j,{loading:l,type:"submit","data-testid":"api-key-save-button-store",children:"Save"})})})]})})}),Le=ke;function He(){const t=me(i=>i.setCurrentFlowId),{scrollId:n}=fe(),[a,l]=h.useState(xe),{autoLogin:s}=h.useContext(y),o=T(i=>i.setSuccessData),c=T(i=>i.setErrorData),{userData:d,setUserData:r}=h.useContext(y),u=f(i=>i.hasStore),m=f(i=>i.validApiKey),p=f(i=>i.hasApiKey),P=f(i=>i.updateHasApiKey),g=f(i=>i.loadingApiKey),x=f(i=>i.updateValidApiKey),O=f(i=>i.updateLoadingApiKey),{password:G,cnfPassword:M,profilePicture:D,apikey:H}=a,{handlePatchPassword:U}=ge(d,o,c),{handleGetProfilePictures:V}=Te(c),{handlePatchProfilePicture:Y}=we(o,c,d,r);Ce(n,t);const{handleSaveKey:B}=be(o,c,P,x,O);function w({target:{name:i,value:W}}){l(q=>({...q,[i]:W}))}return e.jsxs("div",{className:"flex h-full w-full flex-col gap-6",children:[e.jsx(Ee,{}),e.jsxs("div",{className:"grid gap-6",children:[e.jsx($e,{profilePicture:D,handleInput:w,handlePatchProfilePicture:Y,handleGetProfilePictures:V,userData:d}),!s&&e.jsx(Ne,{password:G,cnfPassword:M,handleInput:w,handlePatchPassword:U}),u&&e.jsx(Le,{apikey:H,handleInput:w,handleSaveKey:B,loadingApiKey:g,validApiKey:m,hasApiKey:p})]})]})}export{He as default};
