import{d as ee,f as Q,ae as te,am as ne,an as q,ao as ae,ap as se,aq as re,ar as oe,as as le,at as ie,au as ue,w as H,m as n,c as N,g as R,a as M,a7 as X,i as F,av as ce,aw as de,o as I,l as y,V as fe,v as U,ax as me,a5 as S,ay as pe,az as ge,aA as ve,aB as ye,C as J,z as _e,aC as be,F as xe,aD as De,aE as Te}from"./index-DmG-an2w.js";import{g as ke,c as L}from"./_commonjsHelpers-Cpj98o6Y.js";import{u as Re}from"./usePageTitle-dvSfGJr8.js";var Se="Expected a function",K=NaN,je="[object Symbol]",Ee=/^\s+|\s+$/g,Oe=/^[-+]0x[0-9a-f]+$/i,Ce=/^0b[01]+$/i,Ie=/^0o[0-7]+$/i,Ve=parseInt,he=typeof L=="object"&&L&&L.Object===Object&&L,Be=typeof self=="object"&&self&&self.Object===Object&&self,Ne=he||Be||Function("return this")(),Fe=Object.prototype,Ue=Fe.toString,Le=Math.max,Ae=Math.min,P=function(){return Ne.Date.now()};function $e(e,o,u){var m,c,f,i,a,r,_=0,V=!1,b=!1,k=!0;if(typeof e!="function")throw new TypeError(Se);o=Y(o)||0,W(u)&&(V=!!u.leading,b="maxWait"in u,f=b?Le(Y(u.maxWait)||0,o):f,k="trailing"in u?!!u.trailing:k);function x(t){var d=m,p=c;return m=c=void 0,_=t,i=e.apply(p,d),i}function j(t){return _=t,a=setTimeout(D,o),V?x(t):i}function A(t){var d=t-r,p=t-_,g=o-d;return b?Ae(g,f-p):g}function E(t){var d=t-r,p=t-_;return r===void 0||d>=o||d<0||b&&p>=f}function D(){var t=P();if(E(t))return h(t);a=setTimeout(D,A(t))}function h(t){return a=void 0,k&&m?x(t):(m=c=void 0,i)}function $(){a!==void 0&&clearTimeout(a),_=0,m=r=c=a=void 0}function w(){return a===void 0?i:h(P())}function O(){var t=P(),d=E(t);if(m=arguments,c=this,r=t,d){if(a===void 0)return j(r);if(b)return a=setTimeout(D,o),x(r)}return a===void 0&&(a=setTimeout(D,o)),i}return O.cancel=$,O.flush=w,O}function W(e){var o=typeof e;return!!e&&(o=="object"||o=="function")}function we(e){return!!e&&typeof e=="object"}function ze(e){return typeof e=="symbol"||we(e)&&Ue.call(e)==je}function Y(e){if(typeof e=="number")return e;if(ze(e))return K;if(W(e)){var o=typeof e.valueOf=="function"?e.valueOf():e;e=W(o)?o+"":o}if(typeof e!="string")return e===0?e:+e;e=e.replace(Ee,"");var u=Ce.test(e);return u||Ie.test(e)?Ve(e.slice(2),u?2:8):Oe.test(e)?K:+e}var Me=$e;const Pe=ke(Me),We={class:"events__content"},Ge={class:"events__filters"},Qe={class:"events__controls"},Z=6e4,Je=ee({__name:"Events",setup(e){const o=Q(()=>[{text:"Event Feed"}]),u=te(),{now:m}=ne({interval:Z});Re("Event Feed");const c=q("resource",[]),f=q("events",[]),i=ae({type:"span",seconds:-ce}),{startDate:a,endDate:r}=se(),{selectionStart:_,selectionEnd:V}=re(),b={minRangeInSeconds:De-1,maxRangeInSeconds:Te-1},k=oe(()=>{const{startDate:g,endDate:s}=X.map("DateRangeSelectValue",i.range,"DateRange"),[T,v]=de(f.value,C=>C.endsWith("*")),z=T.map(C=>C.replace(".*",".")),l=["prefect.log.write"].filter(C=>!v.includes(C));return{occurred:{since:_.value??g,until:V.value??s},anyResource:{idPrefix:c.value},event:{prefix:z,name:v,excludeName:l}}}),{page:x,pages:j,loading:A,events:E,empty:D}=le(k,{interval:Z}),{margin:h}=ie(),$=()=>({rootMargin:h.value}),{stuck:w}=ue(u,$),O=Q(()=>({chart:{"events__chart--stuck":w.value}}));let t=!1;const d=Pe(()=>{if(!(!a.value||!r.value)){if(t){t=!1;return}i.range={type:"range",startDate:a.value,endDate:r.value}}},1e3);H([a,r],()=>d());function p(){var T,v;if(!i.range)return;const{startDate:g,endDate:s}=X.map("DateRangeSelectValue",i.range,"DateRange");((T=a.value)==null?void 0:T.getTime())!==g.getTime()&&(t=!0,a.value=g),((v=r.value)==null?void 0:v.getTime())!==s.getTime()&&(t=!0,r.value=s)}return H(()=>i.range,()=>p()),p(),(g,s)=>{const T=F("p-label"),v=F("p-empty-results"),z=F("p-pager"),G=F("p-layout-default");return n(a)&&n(r)?(I(),N(G,{key:0,class:"events"},{header:R(()=>[y(n(fe),{crumbs:o.value},null,8,["crumbs"])]),default:R(()=>[U("div",We,[U("div",Ge,[y(T,{label:"Resource"},{default:R(({id:l})=>[y(n(me),{id:l,selected:n(c),"onUpdate:selected":s[0]||(s[0]=B=>S(c)?c.value=B:null),multiple:""},null,8,["id","selected"])]),_:1}),y(T,{label:"Events"},{default:R(({id:l})=>[y(n(pe),{id:l,selected:n(f),"onUpdate:selected":s[1]||(s[1]=B=>S(f)?f.value=B:null),multiple:""},null,8,["id","selected"])]),_:1})]),U("div",{ref_key:"chart",ref:u,class:ge(["events__chart p-background",O.value.chart])},[y(n(ve),{"start-date":n(a),"onUpdate:startDate":s[2]||(s[2]=l=>S(a)?a.value=l:null),"end-date":n(r),"onUpdate:endDate":s[3]||(s[3]=l=>S(r)?r.value=l:null),filter:k.value,"zoom-options":b},null,8,["start-date","end-date","filter"]),U("div",Qe,[y(n(ye),{modelValue:n(i).range,"onUpdate:modelValue":s[4]||(s[4]=l=>n(i).range=l),max:n(m)},null,8,["modelValue","max"])])],2),n(A)&&n(D)?(I(),N(v,{key:0},{message:R(()=>[J(" Loading events ")]),_:1})):(I(),_e(xe,{key:1},[n(D)?(I(),N(v,{key:0},{message:R(()=>[J(" No events ")]),_:1})):M("",!0),y(n(be),{class:"events__timeline",events:n(E),"start-date":n(a),"end-date":n(r)},null,8,["events","start-date","end-date"]),n(E).length?(I(),N(z,{key:1,page:n(x),"onUpdate:page":s[5]||(s[5]=l=>S(x)?x.value=l:null),pages:n(j),"onUpdate:pages":s[6]||(s[6]=l=>S(j)?j.value=l:null),class:"events__pager"},null,8,["page","pages"])):M("",!0)],64))])]),_:1})):M("",!0)}}});export{Je as default};
//# sourceMappingURL=Events-zhXD4I97.js.map
