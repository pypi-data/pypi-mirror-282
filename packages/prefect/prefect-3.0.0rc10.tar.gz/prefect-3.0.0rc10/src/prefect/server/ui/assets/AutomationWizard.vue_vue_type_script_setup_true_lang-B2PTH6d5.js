import{d as w,L as h,f as S,M as X,i as v,o as g,c as V,U as Y,N as R,O as I,Q as Z,R as J,_ as q,S as tt,z as U,v as B,x as L,l as d,g as y,m as u,r as H,X as K,a as z,Y as et,Z as F,a0 as D,a1 as at,w as P,F as N,A as ot,a2 as nt,C,a3 as st,a4 as W,a5 as j,G as it,H as rt,a6 as ut,a7 as M,a8 as lt,a9 as pt,aa as mt,ab as ct,ac as dt,ad as gt,ae as $,af as E,ag as _t,ah as vt,ai as ft,k as At,aj as yt,ak as bt,al as Tt}from"./index-DmG-an2w.js";const Vt=w({__name:"AutomationActionTypeSelect",props:{type:{required:!0},typeModifiers:{}},emits:["update:type"],setup(f){const n=h(f,"type"),o=S(()=>{const e=X.map(t=>({label:Y[t],value:t}));return n.value==="do-nothing"?e:e.filter(t=>t.value!=="do-nothing")});return(e,t)=>{const l=v("p-select");return g(),V(l,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=m=>n.value=m),options:o.value,class:"automation-action-type-select"},null,8,["modelValue","options"])}}}),wt={class:"automation-wizard-action"},St={class:"automation-wizard-action__header"},kt={class:"automation-wizard-action__heading"},Ut=w({__name:"AutomationWizardAction",props:{index:{},action:{},automation:{}},emits:["delete","update:action"],setup(f,{emit:n}){const o=f,e=n,t=S({get(){return o.action.type??null},set(p){if(R(p)){e("update:action",{});return}const i=I(o.automation.trigger),r=Z(p,i);e("update:action",r)}}),{state:l,error:m}=J(t,"Action Type",p=>!!p),s=S(()=>o.action.type?q(tt,{action:o.action,"onUpdate:action":p=>e("update:action",p)}):null);function c(p){e("update:action",p)}return(p,i)=>{const r=v("p-button"),_=v("p-label"),A=v("p-content");return g(),U("div",wt,[B("div",St,[B("span",kt,"Action "+L(p.index+1),1),d(r,{size:"sm",icon:"TrashIcon",onClick:i[0]||(i[0]=b=>e("delete"))})]),d(A,null,{default:y(()=>[d(_,{label:"Action Type",state:u(l),message:u(m)},{default:y(({id:b})=>[d(Vt,{id:b,type:t.value,"onUpdate:type":i[1]||(i[1]=a=>t.value=a),state:u(l)},null,8,["id","type","state"])]),_:1},8,["state","message"]),s.value?(g(),V(H(s.value.component),K({key:0},s.value.props,{"onUpdate:action":c}),null,16)):z("",!0)]),_:1})])}}}),xt={class:"automation-wizard-step-actions"},zt=w({__name:"AutomationWizardStepActions",props:{automation:{}},emits:["update:automation"],setup(f,{emit:n}){const o=f,e=n,t=et(o.automation.actions??[]);function l(){t.push({})}function m(r){t.splice(r,1)}function s(r,_){t[r]=_}const{error:c}=J(t,"Actions",r=>r.length?!0:"At least 1 action is required"),{defineValidate:p}=F(),{validate:i}=D();return p(i),at(()=>{t.length===0&&l()}),P(t,()=>{e("update:automation",{...o.automation,actions:t.filter(st)})}),(r,_)=>{const A=v("p-divider"),b=v("p-message"),a=v("p-button");return g(),U("div",xt,[(g(),V(nt,null,[(g(!0),U(N,null,ot(t,(T,k)=>(g(),U(N,{key:k},[d(Ut,{action:T,automation:r.automation,index:k,"onUpdate:action":O=>s(k,O),onDelete:O=>m(k)},null,8,["action","automation","index","onUpdate:action","onDelete"]),d(A)],64))),128))],1024)),u(c)?(g(),V(b,{key:0,error:""},{default:y(()=>[C(L(u(c)),1)]),_:1})):z("",!0),d(a,{class:"automations-wizard-step-actions__add",icon:"PlusIcon",onClick:l},{default:y(()=>[C(" Add Action ")]),_:1})])}}}),ht=w({__name:"AutomationWizardStepDetails",props:{automation:{required:!0},automationModifiers:{}},emits:["update:automation"],setup(f){const n=h(f,"automation"),o=W(n,"name"),e=W(n,"description"),{validate:t}=D(),l=(p="",i)=>p.length>0?!0:`${i} is required`,{state:m,error:s}=J(o,"Automation name",l),{defineValidate:c}=F();return c(t),(p,i)=>{const r=v("p-text-input"),_=v("p-label"),A=v("p-content");return g(),V(A,{class:"automation-wizard-step-details"},{default:y(()=>[d(_,{label:"Automation Name",state:u(m),message:u(s)},{default:y(({id:b})=>[d(r,{id:b,modelValue:u(o),"onUpdate:modelValue":i[0]||(i[0]=a=>j(o)?o.value=a:null),state:u(m)},null,8,["id","modelValue","state"])]),_:1},8,["state","message"]),d(_,{label:"Description (Optional)"},{default:y(({id:b})=>[d(r,{id:b,modelValue:u(e),"onUpdate:modelValue":i[1]||(i[1]=a=>j(e)?e.value=a:null)},null,8,["id","modelValue"])]),_:1})]),_:1})}}}),Jt=w({__name:"AutomationTriggerJsonInput",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(f){const n=h(f,"modelValue"),o=s=>{try{const c=JSON.parse(s);M.map("AutomationTriggerResponse",c,"AutomationTrigger")}catch{return!1}return!0},e=(s,c)=>R(s)||lt(s)||pt(s)||mt(s)?`${c} is required`:!0,t=(s,c)=>{try{JSON.parse(s)}catch{return`${c} must be valid JSON`}return!0},{state:l,error:m}=J(n,"Trigger",[e,t,o]);return(s,c)=>{const p=v("p-message"),i=v("p-label");return g(),U(N,null,[d(p,{info:""},{action:y(()=>[d(u(it),{to:u(rt).docs.automationTriggers,small:""},null,8,["to"])]),default:y(()=>[C(" Custom triggers allow advanced configuration of the conditions on which a trigger executes its actions. ")]),_:1}),d(i,{label:"Trigger",state:u(l),message:u(m)},{default:y(()=>[d(u(ut),{modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=r=>n.value=r),class:"automation-trigger-json-input__json-input","show-format-button":"",state:u(l)},null,8,["modelValue","state"])]),_:1},8,["state","message"])],64)}}}),Ot=w({__name:"AutomationTriggerTemplateSelect",props:{template:{required:!0},templateModifiers:{}},emits:["update:template"],setup(f){const n=h(f,"template"),o=S(()=>ct.map(e=>({label:dt(e),value:e})));return(e,t)=>{const l=v("p-select");return g(),V(l,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=m=>n.value=m),"empty-message":"Select template",options:o.value,class:"automation-trigger-template-select"},null,8,["modelValue","options"])}}}),Nt=w({__name:"AutomationWizardStepTrigger",props:{automation:{required:!0},automationModifiers:{}},emits:["update:automation"],setup(f){const n=h(f,"automation"),o=S({get(){return n.value.trigger?I(n.value.trigger):null},set(a){if(R(a)){b(void 0);return}b(E(a))}}),{values:e}=gt(["Form","JSON"]),t=$("Form");function l(){const a=M.map("AutomationTrigger",n.value.trigger,"AutomationTriggerRequest");return vt(a)}const m=$(l());P(()=>n.value.trigger,()=>m.value=l());function s(){const a=JSON.parse(m.value),T=M.map("AutomationTriggerResponse",a,"AutomationTrigger");return b(T),T}async function c(a){t.value!==a&&await i()&&(a==="Form"&&s(),a==="JSON"&&(m.value=l()),t.value=a)}const{defineValidate:p}=F(),{validate:i}=D(),{state:r,error:_}=J(o,"Trigger template",a=>a?!0:"Trigger type is required");p(async()=>{const a=await i();return a&&t.value==="JSON"&&s(),a});const A=S(()=>{if(!o.value)return null;const a=n.value.trigger??E(o.value);switch(a.type){case"event":return q(_t,{template:o.value,trigger:a,"onUpdate:trigger":b});case"compound":case"sequence":return q(ft,{trigger:a,"onUpdate:trigger":b});default:const T=a;throw new Error(`AutomationWizardStepTrigger is missing case for trigger type ${T.type}`)}});function b(a){n.value={...n.value,trigger:a}}return(a,T)=>{const k=v("p-label"),O=v("p-button-group"),G=v("p-content");return g(),V(G,{class:"automation-wizard-step-trigger"},{default:y(()=>[d(k,{label:"Trigger Template",state:u(r),message:u(_)},{default:y(({id:x})=>[d(Ot,{id:x,template:o.value,"onUpdate:template":T[0]||(T[0]=Q=>o.value=Q),state:u(r)},null,8,["id","template","state"])]),_:1},8,["state","message"]),A.value?(g(),U(N,{key:0},[d(O,{class:"automation-wizard-step-trigger__mode-switcher","model-value":t.value,options:u(e),small:"","onUpdate:modelValue":T[1]||(T[1]=x=>c(x))},null,8,["model-value","options"]),t.value==="Form"&&o.value?(g(),V(H(A.value.component),K({key:o.value},A.value.props),null,16)):t.value==="JSON"?(g(),V(Jt,{key:1,modelValue:m.value,"onUpdate:modelValue":T[2]||(T[2]=x=>m.value=x)},null,8,["modelValue"])):z("",!0)],64)):z("",!0)]),_:1})}}}),qt=w({__name:"AutomationWizard",props:{automation:{},editing:{type:Boolean}},emits:["submit"],setup(f,{emit:n}){const o=f,e=$(o.automation??{}),t=n,l=At(),m=S(()=>o.automation?"Save":"Create"),s=[{title:"Trigger",key:"trigger-step"},{title:"Actions",key:"actions-step"},{title:"Details",key:"details-step"}],c=$();function p(){t("submit",new Tt(e.value))}function i(){l.back()}return(r,_)=>(g(),V(u(bt),{ref_key:"wizardRef",ref:c,class:"automation-wizard",steps:s,"last-step-text":m.value,"show-cancel":"",nonlinear:r.editing,"show-save-and-exit":r.editing,onCancel:i,onSubmit:p},{"trigger-step":y(()=>[d(Nt,{automation:e.value,"onUpdate:automation":_[0]||(_[0]=A=>e.value=A)},null,8,["automation"])]),"actions-step":y(()=>[u(yt)(e.value)?(g(),V(zt,{key:0,automation:e.value,"onUpdate:automation":_[1]||(_[1]=A=>e.value=A)},null,8,["automation"])):z("",!0)]),"details-step":y(()=>[d(ht,{automation:e.value,"onUpdate:automation":_[2]||(_[2]=A=>e.value=A)},null,8,["automation"])]),_:1},8,["last-step-text","nonlinear","show-save-and-exit"]))}});export{qt as _};
//# sourceMappingURL=AutomationWizard.vue_vue_type_script_setup_true_lang-B2PTH6d5.js.map
