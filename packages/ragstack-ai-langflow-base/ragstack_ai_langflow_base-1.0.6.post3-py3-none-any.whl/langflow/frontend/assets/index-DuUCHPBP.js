import{j as s,r as x,h as p,aR as Z,aS as U,bA as xe,aM as z,aw as b,b6 as ee,aP as se,I as h,bB as pe,u as W,af as fe,ae as D,S as j,aO as we,b7 as ge,f as k,ba as Q,bC as je}from"./index-CXIlJsYb.js";import{S as F,I as be}from"./index-BSHZinlH.js";import{D as X}from"./index-BHgF7zwx.js";import{C as ve}from"./checkbox-ZfDxhY3h.js";import{c as Ne,e as Ce}from"./form-D2oBPw54.js";import{I as ye}from"./input-sNDUKOHK.js";const qe=()=>s.jsxs("div",{className:"skeleton-card",children:[s.jsxs("div",{className:"skeleton-card-wrapper",children:[s.jsx(F,{className:"h-8 w-8 rounded-full"}),s.jsx(F,{className:"h-4 w-[40%]"})]}),s.jsxs("div",{className:"skeleton-card-text",children:[s.jsx(F,{className:"h-3 w-[90%]"}),s.jsx(F,{className:"h-3 w-[80%]"})]})]}),ke=(e,t,d,l)=>{x.useEffect(()=>{e&&(t((e==null?void 0:e.liked_by_user)??!1),d((e==null?void 0:e.liked_by_count)??0),l((e==null?void 0:e.downloads_count)??0))},[e,e==null?void 0:e.liked_by_count,e==null?void 0:e.liked_by_user,e==null?void 0:e.downloads_count])},Se=ke,_e=(e,t,d,l,m,o,c,r)=>{const f=p(i=>i.addFlow);return{handleInstall:()=>{const i=l;m(u=>Number(u)+1),o(!0),Z(e.id).then(u=>{const a=U(u,u.id,e.is_component);f(!0,a).then(S=>{c({title:`${t} Installed Successfully.`}),o(!1)}).catch(S=>{o(!1),r({title:`Error installing the ${t}`,list:[S.response.data.detail]})})}).catch(u=>{o(!1),r({title:`Error installing the ${t}`,list:[u.response.data.detail]}),m(i)})}}},Ie=_e,Fe=(e,t,d,l,m,o,c,r,f)=>({handleLike:()=>{if(d(!0),l!==void 0||l!==null){const i=l,u=m;o(a=>!a),c(a=>i?a-1:a+1),xe(e.id).then(a=>{d(!1),c(a.data.likes_count),o(a.data.liked_by_user)}).catch(a=>{d(!1),c(u),o(i),a.response.status===403?r(!1):(console.error(a),f({title:`Error liking ${t}.`,list:[a.response.data.detail]}))})}}}),Pe=Fe;function $e({data:e}){return s.jsx(s.Fragment,{children:s.jsx(z,{draggable:!0,className:b("group relative flex flex-col justify-between overflow-hidden transition-all hover:bg-muted/50 hover:shadow-md hover:dark:bg-[#ffffff10]"),children:s.jsx("div",{children:s.jsx(ee,{children:s.jsx("div",{children:s.jsxs(se,{className:"flex w-full items-start justify-between gap-3 text-xl",children:[s.jsx(h,{className:b("visible flex-shrink-0",e.is_component?"mx-0.5 h-6 w-6 text-component-icon":"h-7 w-7 flex-shrink-0 text-flow-icon"),name:e.is_component?"ToyBrick":"Group"}),s.jsx("div",{className:"w-full truncate pr-3",children:e.name})]})})})})})})}const De=e=>{const t=p(l=>l.getFlowById);return{onDragStart:x.useCallback(l=>{let m=s.jsx($e,{data:e});const o=document.createElement("div");o.style.transform="translate(-10000px, -10000px)",o.style.position="absolute",document.body.appendChild(o),l.dataTransfer.setDragImage(o,0,0),pe(o).render(m),t(e.id)&&l.dataTransfer.setData("flow",JSON.stringify(e))},[e])}},Ee=De,Te=(e,t,d,l,m,o,c)=>{x.useEffect(()=>{var r,f;e&&t&&(d?(m(((r=l==null?void 0:l.data)==null?void 0:r.nodes)??[],!0),o(((f=l==null?void 0:l.data)==null?void 0:f.edges)??[],!0)):(m([],!0),o([],!0)),c())},[d])},Le=Te;function Y(e){return e.replace(/ /g,"-").toLowerCase()}function Ge({data:e,authorized:t=!0,disabled:d=!1,button:l,onClick:m,onDelete:o,playground:c,control:r,is_component:f}){var K;p(n=>n.addFlow);const N=W(n=>n.setSuccessData),i=W(n=>n.setErrorData),u=fe(n=>n.updateValidApiKey),a=D(n=>n.CleanFlowPool),S=!1,[C,ne]=x.useState(!1),[te,oe]=x.useState(!1),[E,T]=x.useState((e==null?void 0:e.liked_by_user)??!1),[L,B]=x.useState((e==null?void 0:e.liked_by_count)??0),[O,A]=x.useState((e==null?void 0:e.downloads_count)??0),le=p(n=>n.currentFlow),M=p(n=>n.setCurrentFlow),H=p(n=>n.getFlowById),re=p(n=>n.currentFlowId),ce=D(n=>n.setNodes),ie=D(n=>n.setEdges),[P,y]=x.useState(!1),[R,ae]=x.useState(!1),V=p(n=>n.setCurrentFlowId),[_,w]=x.useState(!1),$=p(n=>n.selectedFlowsComponentsCards),q=e.is_component?"Component":"Flow";async function G(){const n=await Z(e.id);return U(n,n.id,e.is_component,!0)}function I(n){var J;if(!n)return!1;const{inputs:g,outputs:v}=je(((J=n==null?void 0:n.data)==null?void 0:J.nodes)??[]);return g.length>0||v.length>0}Le(re,c,P,le,ce,ie,a),Se(e,T,B,A);const{handleInstall:de}=Ie(e,q,S,O,A,ne,N,i),{handleLike:me}=Pe(e,q,oe,E,L,T,B,u,i),ue=($==null?void 0:$.includes(e==null?void 0:e.id))??!1,{onDragStart:he}=Ee(e);return s.jsxs(s.Fragment,{children:[s.jsxs(z,{onDragStart:he,draggable:!0,"data-testid":`card-${Y(e.name)}`,className:b("group relative flex h-[11rem] flex-col justify-between overflow-hidden hover:bg-muted/50 hover:shadow-md hover:dark:bg-[#5f5f5f0e]",d?"pointer-events-none opacity-50":"",m?"cursor-pointer":"",ue?"border border-selected":""),onClick:m,children:[s.jsx("div",{children:s.jsxs(ee,{children:[s.jsx("div",{children:s.jsxs(se,{className:"flex w-full items-start justify-between gap-3 text-xl",children:[s.jsx(h,{className:b("visible flex-shrink-0",e.is_component?"mx-0.5 h-6 w-6 text-component-icon":"h-7 w-7 flex-shrink-0 text-flow-icon"),name:e.is_component?"ToyBrick":"Group"}),s.jsx(j,{content:e.name,children:s.jsx("div",{className:"w-full truncate pr-3",children:e.name})}),(e==null?void 0:e.metadata)!==void 0&&s.jsxs("div",{className:"flex items-center gap-3",children:[e.private&&s.jsx(j,{content:"Private",children:s.jsx("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:s.jsx(h,{name:"Lock",className:"h-4 w-4"})})}),!e.is_component&&s.jsx(j,{content:"Components",children:s.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[s.jsx(h,{name:"ToyBrick",className:"h-4 w-4"}),s.jsx("span",{"data-testid":`total-${e.name}`,children:((K=e==null?void 0:e.metadata)==null?void 0:K.total)??0})]})}),s.jsx(j,{content:"Likes",children:s.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[s.jsx(h,{name:"Heart",className:b("h-4 w-4")}),s.jsx("span",{"data-testid":`likes-${e.name}`,children:L??0})]})}),s.jsx(j,{content:"Downloads",children:s.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[s.jsx(h,{name:"DownloadCloud",className:"h-4 w-4"}),s.jsx("span",{"data-testid":`downloads-${e.name}`,children:O??0})]})})]}),r&&s.jsx("div",{className:"flex",onClick:n=>{n.stopPropagation()},children:s.jsx(Ne,{control:r,name:`${e.id}`,defaultValue:!1,render:({field:n})=>s.jsx(Ce,{children:s.jsx(ve,{"data-testid":"checkbox-component","aria-label":"checkbox-component",checked:n.value,onCheckedChange:n.onChange,className:"h-5 w-5 border border-ring data-[state=checked]:border-selected data-[state=checked]:bg-selected"})})})})]})}),s.jsxs("div",{className:"flex gap-2",children:[e.user_created&&e.user_created.username&&s.jsxs("span",{className:"text-sm text-primary",children:["by ",s.jsx("b",{children:e.user_created.username}),e.last_tested_version&&s.jsxs(s.Fragment,{children:[" ","|"," ",s.jsxs("span",{className:"text-xs",children:[" ","⛓︎ v",e.last_tested_version]})]})]}),s.jsx("div",{className:"flex w-full flex-1 flex-wrap gap-2"})]}),s.jsx(we,{className:"pb-2 pt-2",children:s.jsx("div",{className:(e==null?void 0:e.metadata)!==void 0?"truncate":"truncate-doubleline",children:e.description})})]})}),s.jsx(ge,{children:s.jsx("div",{className:"z-50 flex w-full items-center justify-between gap-2",children:s.jsxs("div",{className:"flex w-full flex-wrap items-end justify-end gap-2",children:[c&&(e==null?void 0:e.metadata)!==void 0?s.jsxs(k,{disabled:_||!t,tabIndex:-1,variant:"outline",size:"sm",className:"z-50 gap-2 whitespace-nowrap","data-testid":"playground-flow-button-"+e.id,onClick:n=>{n.preventDefault(),n.stopPropagation(),w(!0);const g=H(e.id);if(g){if(!I(g)){i({title:"Error",list:["This flow doesn't have a playground."]}),w(!1);return}V(e.id),y(!0),w(!1)}else G().then(v=>{if(!I(v)){i({title:"Error",list:["This flow doesn't have a playground."]}),w(!1);return}M(v),y(!0),w(!1)})},children:[_?s.jsx(Q,{className:"h-4 w-4 text-medium-indigo"}):s.jsx(h,{name:"BotMessageSquareIcon",className:"h-4 w-4 select-none"}),"Playground"]},e.id):void 0,e.liked_by_count!=null&&s.jsxs("div",{className:"flex gap-0.5",children:[o&&(e==null?void 0:e.metadata)!==void 0?s.jsx(j,{content:t?"Delete":"Please review your API key.",children:s.jsx(X,{onConfirm:o,children:s.jsx(k,{variant:"ghost",size:"icon",className:"whitespace-nowrap"+(t?"":" cursor-not-allowed"),children:s.jsx(h,{"data-testid":`delete-${Y(e.name)}`,name:"Trash2",className:b("h-5 w-5",t?"":"text-ring")})})})}):s.jsx(j,{content:t?"Like":"Please review your API key.",children:s.jsx(k,{disabled:te,variant:"ghost",size:"icon",className:"whitespace-nowrap"+(t?"":" cursor-not-allowed"),onClick:()=>{t&&me()},"data-testid":`like-${e.name}`,children:s.jsx(h,{name:"Heart",className:b("h-5 w-5",E?"fill-destructive stroke-destructive":"",t?"":"text-ring")})})}),s.jsx(j,{content:t?"Install Locally":"Please review your API key.",children:s.jsx(k,{disabled:C,variant:"ghost",size:"icon",className:"whitespace-nowrap"+(t?"":" cursor-not-allowed")+(C?"":" p-0.5"),onClick:()=>{C||!t||de()},"data-testid":`install-${e.name}`,children:s.jsx(h,{name:C?"Loader2":"Plus",className:b(C?"h-5 w-5 animate-spin":"h-5 w-5",t?"":"text-ring")})})})]}),c&&(e==null?void 0:e.metadata)===void 0&&s.jsxs(k,{disabled:_||!t,tabIndex:-1,variant:"primary",size:"sm",className:"gap-2 whitespace-nowrap bg-muted","data-testid":"playground-flow-button-"+e.id,onClick:n=>{n.preventDefault(),n.stopPropagation(),w(!0);const g=H(e.id);if(g){if(!I(g)){i({title:"Error",list:["This flow doesn't have a playground."]}),w(!1);return}V(e.id),y(!0),w(!1)}else G().then(v=>{if(!I(v)){i({title:"Error",list:["This flow doesn't have a playground."]}),w(!1);return}M(v),y(!0),w(!1)})},children:[_?s.jsx(Q,{className:"h-4 w-4 text-medium-indigo"}):s.jsx(h,{name:"BotMessageSquareIcon",className:"h-4 w-4 select-none"}),"Playground"]},e.id)]})})})]}),P&&s.jsx(be,{cleanOnClose:!0,open:P,setOpen:y,children:s.jsx(s.Fragment,{})}),R&&s.jsx(X,{open:R,setOpen:ae,onConfirm:()=>{o&&o()},description:` ${f?"component":"flow"}`,children:s.jsx(s.Fragment,{})})]})}const Be=({loading:e,divClasses:t,onChange:d,onClick:l,value:m,onKeyDown:o})=>{const c=window.location.pathname,r=p(u=>u.allFlows),f=p(u=>u.searchFlowsComponents),N=e||!r||(r==null?void 0:r.length)===0&&f==="",i=()=>c.includes("flows")?"Search Flows":c.includes("components")?"Search Components":"Search Flows and Components";return s.jsx(s.Fragment,{children:s.jsxs("div",{className:`${t||"relative h-12 w-[60%]"}`,children:[s.jsx(ye,{"data-testid":"search-store-input",disabled:N,placeholder:i(),className:"absolute h-12 pl-5 pr-12",onChange:d,onKeyDown:o,value:m}),s.jsx("button",{onClick:l,disabled:e,className:"absolute bottom-0 right-4 top-0 my-auto h-6 cursor-pointer stroke-1 text-muted-foreground","data-testid":"search-store-button",children:s.jsx(h,{name:e?"Loader2":"Search",className:e?"animate-spin cursor-not-allowed":""})})]})})},Ke=Be;export{Ge as C,Ke as I,qe as S};
