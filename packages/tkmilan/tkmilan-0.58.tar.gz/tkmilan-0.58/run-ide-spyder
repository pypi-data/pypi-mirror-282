#!/bin/bash
set -e

# Make sure the virtual environment is setup
make venv
# Make sure IDE is configured
# - Check if it is already available
# - Otherwise, install it on the venv
if ! command -v spyder >/dev/null 2>/dev/null; then
	make venv REQUIREMENTS_TXT=requirements-ide.txt MARKER=.initialized-ide.venv
fi

# Activate the virtual environment
# shellcheck disable=1091
source "$(unset -v MAKELEVEL; make show-venv-bin)/activate"

# Generate Python entrypoints
python release/build-entrypoints --quiet --traceback-limit 1000 generate-python

# Run Spyder (Open Main Entrypoint)
exec spyder --project="$PWD" --workdir="$PWD" "$@" \
	build/bin/tkmilan-showcase
